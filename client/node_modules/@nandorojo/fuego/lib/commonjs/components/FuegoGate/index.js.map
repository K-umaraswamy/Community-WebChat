{"version":3,"sources":["index.tsx"],"names":["AuthGate","props","LoadingComponent","displayName","photoURL","user","setUser","context","auth","unsubcribe","onIdTokenChanged","u","beforeAuthUpdate","start","AuthComponent","signInAnonymously","currentUser","updateProfile","console","error","children"],"mappings":"mfAAA,qDAQA,oF,qGAEA,GAAMA,CAAAA,QAA0C,CAAG,QAA7CA,CAAAA,QAA6C,CAAAC,KAAK,CAAI,IAClDC,CAAAA,gBADkD,CACND,KADM,CAClDC,gBADkD,CAChCC,WADgC,CACNF,KADM,CAChCE,WADgC,CACnBC,QADmB,CACNH,KADM,CACnBG,QADmB,eAElC,oBAA2C,SAA3C,CAFkC,qDAEnDC,IAFmD,eAE7CC,OAF6C,eAG1D,GAAMC,CAAAA,OAAO,CAAG,8BAAhB,CAH0D,GAIlDC,CAAAA,IAJkD,CAIzCD,OAJyC,CAIlDC,IAJkD,CAM1D,qBAAU,UAAM,CACd,GAAMC,CAAAA,UAAU,CAAGD,IAAI,GAAGE,gBAAP,CAAwB,SAAAC,CAAC,CAAI,CAC9C,GAAIV,KAAK,CAACW,gBAAV,CAA4BX,KAAK,CAACW,gBAAN,CAAuBD,CAAvB,EAC5BL,OAAO,CAACK,CAAD,CAAP,CACD,CAHkB,CAAnB,CAIA,MAAOF,CAAAA,UAAP,CACD,CAND,CAMG,EANH,EAQA,qBAAU,UAAM,CACd,GAAMI,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,8JAEN,CAACZ,KAAK,CAACa,aAAP,EAAwBb,KAAK,CAACc,iBAFxB,6EAGFP,IAAI,GAAGO,iBAAP,EAHE,eAIgBP,IAAI,EAJpB,CAIAQ,WAJA,OAIAA,WAJA,MAKJb,WAAW,EAAIa,WALX,8BAODZ,QAPC,4EAQGY,WAAD,CAA+BC,aAA/B,CAA6C,CACjDd,WAAW,CAAXA,WADiD,CAA7C,CARF,2CAWMA,WAXN,6EAYGa,WAAD,CAA+BC,aAA/B,CAA6C,CACjDb,QAAQ,CAARA,QADiD,CAA7C,CAZF,4FAgBGY,WAAD,CAA+BC,aAA/B,CAA6C,CACjDb,QAAQ,CAARA,QADiD,CAEjDD,WAAW,CAAXA,WAFiD,CAA7C,CAhBF,2FAwBVe,OAAO,CAACC,KAAR,CAAc,8BAAd,cAxBU,kEAAd,CA2BAN,KAAK,GACN,CA7BD,CA6BG,CACDZ,KAAK,CAACc,iBADL,CAEDd,KAAK,CAACE,WAFL,CAGDF,KAAK,CAACG,QAHL,CAIDH,KAAK,CAACa,aAJL,CA7BH,EAoCA,GAAIT,IAAI,GAAK,SAAb,CAAwB,MAAOH,CAAAA,gBAAgB,CAAG,6BAAC,gBAAD,kDAAH,CAA0B,IAAjD,CAExB,GAAI,CAACG,IAAD,EAASJ,KAAK,CAACa,aAAnB,CAAkC,CAChC,GAAMA,CAAAA,aAAa,CAAGb,KAAK,CAACa,aAA5B,CAEA,MAAO,8BAAC,aAAD,0BAAmBP,OAAnB,CAAgCN,KAAhC,mDAAP,CACD,CAED,MAAO,2DAAGA,KAAK,CAACmB,QAAT,CAAP,CACD,CA3DD,C,aA6DepB,Q","sourcesContent":["import React, {\n  useEffect,\n  useState,\n  FunctionComponent,\n  ComponentType\n} from 'react'\nimport firebase from 'firebase/app'\nimport { AuthGateProps } from './types'\nimport useFuegoContext from '../../hooks/useFuegoContext'\n\nconst AuthGate: FunctionComponent<AuthGateProps> = props => {\n  const { LoadingComponent, displayName, photoURL } = props\n  const [user, setUser] = useState<firebase.User | null | 'loading'>('loading')\n  const context = useFuegoContext()\n  const { auth } = context\n\n  useEffect(() => {\n    const unsubcribe = auth().onIdTokenChanged(u => {\n      if (props.beforeAuthUpdate) props.beforeAuthUpdate(u)\n      setUser(u)\n    })\n    return unsubcribe\n  }, [])\n\n  useEffect(() => {\n    const start = async () => {\n      try {\n        if (!props.AuthComponent && props.signInAnonymously) {\n          await auth().signInAnonymously()\n          const { currentUser } = auth()\n          if (displayName || currentUser) {\n            //   well this is just terrible but whatever fix later\n            if (!photoURL) {\n              await (currentUser as firebase.User).updateProfile({\n                displayName\n              })\n            } else if (!displayName) {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL\n              })\n            } else {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL,\n                displayName\n              })\n            }\n          }\n        }\n      } catch (e) {\n        console.error('fuego AuthGate sign in error', e)\n      }\n    }\n    start()\n  }, [\n    props.signInAnonymously,\n    props.displayName,\n    props.photoURL,\n    props.AuthComponent\n  ])\n\n  if (user === 'loading') return LoadingComponent ? <LoadingComponent /> : null\n\n  if (!user && props.AuthComponent) {\n    const AuthComponent = props.AuthComponent as ComponentType\n\n    return <AuthComponent {...context} {...props} />\n  }\n\n  return <>{props.children}</>\n}\n\nexport default AuthGate\n"]}