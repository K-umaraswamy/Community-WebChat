var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _useFuegoContext=_interopRequireDefault(require("../../hooks/useFuegoContext"));var _jsxFileName="/Users/Fernando/Developer/Learning Babel/fuego/src/components/FuegoGate/index.tsx";var AuthGate=function AuthGate(props){var LoadingComponent=props.LoadingComponent,displayName=props.displayName,photoURL=props.photoURL;var _useState=(0,_react.useState)('loading'),_useState2=(0,_slicedToArray2.default)(_useState,2),user=_useState2[0],setUser=_useState2[1];var context=(0,_useFuegoContext.default)();var auth=context.auth;(0,_react.useEffect)(function(){var unsubcribe=auth().onIdTokenChanged(function(u){if(props.beforeAuthUpdate)props.beforeAuthUpdate(u);setUser(u);});return unsubcribe;},[]);(0,_react.useEffect)(function(){var start=function start(){var _auth,currentUser;return _regenerator.default.async(function start$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;if(!(!props.AuthComponent&&props.signInAnonymously)){_context.next=18;break;}_context.next=4;return _regenerator.default.awrap(auth().signInAnonymously());case 4:_auth=auth(),currentUser=_auth.currentUser;if(!(displayName||currentUser)){_context.next=18;break;}if(photoURL){_context.next=11;break;}_context.next=9;return _regenerator.default.awrap(currentUser.updateProfile({displayName:displayName}));case 9:_context.next=18;break;case 11:if(displayName){_context.next=16;break;}_context.next=14;return _regenerator.default.awrap(currentUser.updateProfile({photoURL:photoURL}));case 14:_context.next=18;break;case 16:_context.next=18;return _regenerator.default.awrap(currentUser.updateProfile({photoURL:photoURL,displayName:displayName}));case 18:_context.next=23;break;case 20:_context.prev=20;_context.t0=_context["catch"](0);console.error('fuego AuthGate sign in error',_context.t0);case 23:case"end":return _context.stop();}}},null,null,[[0,20]]);};start();},[props.signInAnonymously,props.displayName,props.photoURL,props.AuthComponent]);if(user==='loading')return LoadingComponent?_react.default.createElement(LoadingComponent,{__source:{fileName:_jsxFileName,lineNumber:61}}):null;if(!user&&props.AuthComponent){var AuthComponent=props.AuthComponent;return _react.default.createElement(AuthComponent,(0,_extends2.default)({},context,props,{__source:{fileName:_jsxFileName,lineNumber:66}}));}return _react.default.createElement(_react.default.Fragment,null,props.children);};var _default=AuthGate;exports.default=_default;
//# sourceMappingURL=index.js.map