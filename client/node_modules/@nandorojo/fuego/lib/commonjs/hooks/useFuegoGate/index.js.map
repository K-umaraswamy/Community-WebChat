{"version":3,"sources":["index.ts"],"names":["props","user","setUser","displayName","photoURL","unsubcribe","firebase","auth","onIdTokenChanged","u","beforeAuthUpdate","start","AuthComponent","signInAnonymously","currentUser","updateProfile","console","error"],"mappings":"gVAAA,4BACA,yDAIe,kBAASA,KAAT,CAA+B,eACpB,oBAA2C,SAA3C,CADoB,qDACrCC,IADqC,eAC/BC,OAD+B,kBAGpCC,CAAAA,WAHoC,CAGVH,KAHU,CAGpCG,WAHoC,CAGvBC,QAHuB,CAGVJ,KAHU,CAGvBI,QAHuB,CAK5C,qBAAU,UAAM,CACd,GAAMC,CAAAA,UAAU,CAAGC,aAASC,IAAT,GAAgBC,gBAAhB,CAAiC,SAAAC,CAAC,CAAI,CACvD,GAAIT,KAAK,CAACU,gBAAV,CAA4BV,KAAK,CAACU,gBAAN,CAAuBD,CAAvB,EAC5BP,OAAO,CAACO,CAAD,CAAP,CACD,CAHkB,CAAnB,CAIA,MAAOJ,CAAAA,UAAP,CACD,CAND,CAMG,EANH,EAQA,qBAAU,UAAM,CACd,GAAMM,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,uKAEN,CAACX,KAAK,CAACY,aAAP,EAAwBZ,KAAK,CAACa,iBAFxB,6EAGFP,aAASC,IAAT,GAAgBM,iBAAhB,EAHE,wBAIgBP,aAASC,IAAT,EAJhB,CAIAO,WAJA,gBAIAA,WAJA,MAKJX,WAAW,EAAIW,WALX,8BAODV,QAPC,4EAQGU,WAAD,CAA+BC,aAA/B,CAA6C,CACjDZ,WAAW,CAAXA,WADiD,CAA7C,CARF,2CAWMA,WAXN,6EAYGW,WAAD,CAA+BC,aAA/B,CAA6C,CACjDX,QAAQ,CAARA,QADiD,CAA7C,CAZF,4FAgBGU,WAAD,CAA+BC,aAA/B,CAA6C,CACjDX,QAAQ,CAARA,QADiD,CAEjDD,WAAW,CAAXA,WAFiD,CAA7C,CAhBF,2FAwBVa,OAAO,CAACC,KAAR,CAAc,8BAAd,cAxBU,kEAAd,CA2BAN,KAAK,GACN,CA7BD,CA6BG,CAACX,KAAK,CAACa,iBAAP,CAA0BV,WAA1B,CAAuCC,QAAvC,CAAiDJ,KAAK,CAACY,aAAvD,CA7BH,EA8BA,MAAO,EAAP,CACD","sourcesContent":["import { useState, useEffect } from 'react'\nimport firebase from 'firebase/app'\nimport { AuthGateProps } from '../../components/FuegoGate/types'\n\n// TODO this is fucked, redo it for hooks\nexport default function(props: AuthGateProps) {\n  const [user, setUser] = useState<firebase.User | null | 'loading'>('loading')\n\n  const { displayName, photoURL } = props\n\n  useEffect(() => {\n    const unsubcribe = firebase.auth().onIdTokenChanged(u => {\n      if (props.beforeAuthUpdate) props.beforeAuthUpdate(u)\n      setUser(u)\n    })\n    return unsubcribe\n  }, [])\n\n  useEffect(() => {\n    const start = async () => {\n      try {\n        if (!props.AuthComponent || props.signInAnonymously) {\n          await firebase.auth().signInAnonymously()\n          const { currentUser } = firebase.auth()\n          if (displayName || currentUser) {\n            //   well this is just terrible but whatever fix later\n            if (!photoURL) {\n              await (currentUser as firebase.User).updateProfile({\n                displayName\n              })\n            } else if (!displayName) {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL\n              })\n            } else {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL,\n                displayName\n              })\n            }\n          }\n        }\n      } catch (e) {\n        console.error('fuego AuthGate sign in error', e)\n      }\n    }\n    start()\n  }, [props.signInAnonymously, displayName, photoURL, props.AuthComponent])\n  return {}\n}\n"]}