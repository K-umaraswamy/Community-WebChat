import _regeneratorRuntime from"@babel/runtime/regenerator";import{useEffect,useMemo,useCallback,useRef}from'react';import useFuegoContext from'../useFuegoContext';import useAppState from'../useAppState';export default(function(){var _useFuegoContext=useFuegoContext(),auth=_useFuegoContext.auth,firebase=_useFuegoContext.firebase;var uid='';var lastSentStatus=useRef();var ready=useRef(false);var databaseRef=useMemo(function(){return firebase.database().ref("/status/"+uid);},[uid]);var status=useCallback(function(state){return{state:state,lastChanged:firebase.database.ServerValue.TIMESTAMP};},[]);var onAppStateChange=useCallback(function(state){if(ready.current&&state!==lastSentStatus.current){databaseRef.set(status(state));}},[]);useAppState(onAppStateChange);try{;var _ref=auth().currentUser;uid=_ref.uid;}catch(e){console.error('oh shoot, invalid auth in useOnlineStatus hook',e);}useEffect(function(){var infoRef=firebase.database().ref('.info/connected');infoRef.on('value',function _callee(snapshot){return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(snapshot.val()){_context.next=2;break;}return _context.abrupt("return");case 2:_context.prev=2;_context.next=5;return _regeneratorRuntime.awrap(databaseRef.onDisconnect().set(status('inactive')));case 5:ready.current=true;lastSentStatus.current='active';databaseRef.set(status(lastSentStatus.current));_context.next=13;break;case 10:_context.prev=10;_context.t0=_context["catch"](2);console.error("useOnlineStatus error within snapshot listener "+_context.t0);case 13:case"end":return _context.stop();}}},null,null,[[2,10]]);});return function(){try{lastSentStatus.current='inactive';databaseRef.set(status(lastSentStatus.current));infoRef.off('value');}catch(e){console.error('useOnlineStatus cleanup effect error',e);}};},[uid]);});
//# sourceMappingURL=index.js.map