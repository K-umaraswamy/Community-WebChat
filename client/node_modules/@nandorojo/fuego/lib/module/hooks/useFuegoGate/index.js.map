{"version":3,"sources":["index.ts"],"names":["useState","useEffect","firebase","props","user","setUser","displayName","photoURL","unsubcribe","auth","onIdTokenChanged","u","beforeAuthUpdate","start","AuthComponent","signInAnonymously","currentUser","updateProfile","console","error"],"mappings":"6HAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,MAAOC,CAAAA,QAAP,KAAqB,cAArB,CAIA,cAAe,UAASC,KAAT,CAA+B,eACpBH,QAAQ,CAAmC,SAAnC,CADY,wCACrCI,IADqC,eAC/BC,OAD+B,kBAGpCC,CAAAA,WAHoC,CAGVH,KAHU,CAGpCG,WAHoC,CAGvBC,QAHuB,CAGVJ,KAHU,CAGvBI,QAHuB,CAK5CN,SAAS,CAAC,UAAM,CACd,GAAMO,CAAAA,UAAU,CAAGN,QAAQ,CAACO,IAAT,GAAgBC,gBAAhB,CAAiC,SAAAC,CAAC,CAAI,CACvD,GAAIR,KAAK,CAACS,gBAAV,CAA4BT,KAAK,CAACS,gBAAN,CAAuBD,CAAvB,EAC5BN,OAAO,CAACM,CAAD,CAAP,CACD,CAHkB,CAAnB,CAIA,MAAOH,CAAAA,UAAP,CACD,CANQ,CAMN,EANM,CAAT,CAQAP,SAAS,CAAC,UAAM,CACd,GAAMY,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,sKAEN,CAACV,KAAK,CAACW,aAAP,EAAwBX,KAAK,CAACY,iBAFxB,4EAGFb,QAAQ,CAACO,IAAT,GAAgBM,iBAAhB,EAHE,wBAIgBb,QAAQ,CAACO,IAAT,EAJhB,CAIAO,WAJA,gBAIAA,WAJA,MAKJV,WAAW,EAAIU,WALX,8BAODT,QAPC,2EAQGS,WAAD,CAA+BC,aAA/B,CAA6C,CACjDX,WAAW,CAAXA,WADiD,CAA7C,CARF,2CAWMA,WAXN,4EAYGU,WAAD,CAA+BC,aAA/B,CAA6C,CACjDV,QAAQ,CAARA,QADiD,CAA7C,CAZF,2FAgBGS,WAAD,CAA+BC,aAA/B,CAA6C,CACjDV,QAAQ,CAARA,QADiD,CAEjDD,WAAW,CAAXA,WAFiD,CAA7C,CAhBF,2FAwBVY,OAAO,CAACC,KAAR,CAAc,8BAAd,cAxBU,kEAAd,CA2BAN,KAAK,GACN,CA7BQ,CA6BN,CAACV,KAAK,CAACY,iBAAP,CAA0BT,WAA1B,CAAuCC,QAAvC,CAAiDJ,KAAK,CAACW,aAAvD,CA7BM,CAAT,CA8BA,MAAO,EAAP,CACD","sourcesContent":["import { useState, useEffect } from 'react'\nimport firebase from 'firebase/app'\nimport { AuthGateProps } from '../../components/FuegoGate/types'\n\n// TODO this is fucked, redo it for hooks\nexport default function(props: AuthGateProps) {\n  const [user, setUser] = useState<firebase.User | null | 'loading'>('loading')\n\n  const { displayName, photoURL } = props\n\n  useEffect(() => {\n    const unsubcribe = firebase.auth().onIdTokenChanged(u => {\n      if (props.beforeAuthUpdate) props.beforeAuthUpdate(u)\n      setUser(u)\n    })\n    return unsubcribe\n  }, [])\n\n  useEffect(() => {\n    const start = async () => {\n      try {\n        if (!props.AuthComponent || props.signInAnonymously) {\n          await firebase.auth().signInAnonymously()\n          const { currentUser } = firebase.auth()\n          if (displayName || currentUser) {\n            //   well this is just terrible but whatever fix later\n            if (!photoURL) {\n              await (currentUser as firebase.User).updateProfile({\n                displayName\n              })\n            } else if (!displayName) {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL\n              })\n            } else {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL,\n                displayName\n              })\n            }\n          }\n        }\n      } catch (e) {\n        console.error('fuego AuthGate sign in error', e)\n      }\n    }\n    start()\n  }, [props.signInAnonymously, displayName, photoURL, props.AuthComponent])\n  return {}\n}\n"]}