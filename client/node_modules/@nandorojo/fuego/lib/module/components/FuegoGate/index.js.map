{"version":3,"sources":["index.tsx"],"names":["React","useEffect","useState","useFuegoContext","AuthGate","props","LoadingComponent","displayName","photoURL","user","setUser","context","auth","unsubcribe","onIdTokenChanged","u","beforeAuthUpdate","start","AuthComponent","signInAnonymously","currentUser","updateProfile","console","error","children"],"mappings":"uRAAA,MAAOA,CAAAA,KAAP,EACEC,SADF,CAEEC,QAFF,KAKO,OALP,CAQA,MAAOC,CAAAA,eAAP,KAA4B,6BAA5B,CAEA,GAAMC,CAAAA,QAA0C,CAAG,QAA7CA,CAAAA,QAA6C,CAAAC,KAAK,CAAI,IAClDC,CAAAA,gBADkD,CACND,KADM,CAClDC,gBADkD,CAChCC,WADgC,CACNF,KADM,CAChCE,WADgC,CACnBC,QADmB,CACNH,KADM,CACnBG,QADmB,eAElCN,QAAQ,CAAmC,SAAnC,CAF0B,wCAEnDO,IAFmD,eAE7CC,OAF6C,eAG1D,GAAMC,CAAAA,OAAO,CAAGR,eAAe,EAA/B,CAH0D,GAIlDS,CAAAA,IAJkD,CAIzCD,OAJyC,CAIlDC,IAJkD,CAM1DX,SAAS,CAAC,UAAM,CACd,GAAMY,CAAAA,UAAU,CAAGD,IAAI,GAAGE,gBAAP,CAAwB,SAAAC,CAAC,CAAI,CAC9C,GAAIV,KAAK,CAACW,gBAAV,CAA4BX,KAAK,CAACW,gBAAN,CAAuBD,CAAvB,EAC5BL,OAAO,CAACK,CAAD,CAAP,CACD,CAHkB,CAAnB,CAIA,MAAOF,CAAAA,UAAP,CACD,CANQ,CAMN,EANM,CAAT,CAQAZ,SAAS,CAAC,UAAM,CACd,GAAMgB,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,6JAEN,CAACZ,KAAK,CAACa,aAAP,EAAwBb,KAAK,CAACc,iBAFxB,4EAGFP,IAAI,GAAGO,iBAAP,EAHE,eAIgBP,IAAI,EAJpB,CAIAQ,WAJA,OAIAA,WAJA,MAKJb,WAAW,EAAIa,WALX,8BAODZ,QAPC,2EAQGY,WAAD,CAA+BC,aAA/B,CAA6C,CACjDd,WAAW,CAAXA,WADiD,CAA7C,CARF,2CAWMA,WAXN,4EAYGa,WAAD,CAA+BC,aAA/B,CAA6C,CACjDb,QAAQ,CAARA,QADiD,CAA7C,CAZF,2FAgBGY,WAAD,CAA+BC,aAA/B,CAA6C,CACjDb,QAAQ,CAARA,QADiD,CAEjDD,WAAW,CAAXA,WAFiD,CAA7C,CAhBF,2FAwBVe,OAAO,CAACC,KAAR,CAAc,8BAAd,cAxBU,kEAAd,CA2BAN,KAAK,GACN,CA7BQ,CA6BN,CACDZ,KAAK,CAACc,iBADL,CAEDd,KAAK,CAACE,WAFL,CAGDF,KAAK,CAACG,QAHL,CAIDH,KAAK,CAACa,aAJL,CA7BM,CAAT,CAoCA,GAAIT,IAAI,GAAK,SAAb,CAAwB,MAAOH,CAAAA,gBAAgB,CAAG,oBAAC,gBAAD,kDAAH,CAA0B,IAAjD,CAExB,GAAI,CAACG,IAAD,EAASJ,KAAK,CAACa,aAAnB,CAAkC,CAChC,GAAMA,CAAAA,aAAa,CAAGb,KAAK,CAACa,aAA5B,CAEA,MAAO,qBAAC,aAAD,aAAmBP,OAAnB,CAAgCN,KAAhC,mDAAP,CACD,CAED,MAAO,yCAAGA,KAAK,CAACmB,QAAT,CAAP,CACD,CA3DD,CA6DA,cAAepB,CAAAA,QAAf","sourcesContent":["import React, {\n  useEffect,\n  useState,\n  FunctionComponent,\n  ComponentType\n} from 'react'\nimport firebase from 'firebase/app'\nimport { AuthGateProps } from './types'\nimport useFuegoContext from '../../hooks/useFuegoContext'\n\nconst AuthGate: FunctionComponent<AuthGateProps> = props => {\n  const { LoadingComponent, displayName, photoURL } = props\n  const [user, setUser] = useState<firebase.User | null | 'loading'>('loading')\n  const context = useFuegoContext()\n  const { auth } = context\n\n  useEffect(() => {\n    const unsubcribe = auth().onIdTokenChanged(u => {\n      if (props.beforeAuthUpdate) props.beforeAuthUpdate(u)\n      setUser(u)\n    })\n    return unsubcribe\n  }, [])\n\n  useEffect(() => {\n    const start = async () => {\n      try {\n        if (!props.AuthComponent && props.signInAnonymously) {\n          await auth().signInAnonymously()\n          const { currentUser } = auth()\n          if (displayName || currentUser) {\n            //   well this is just terrible but whatever fix later\n            if (!photoURL) {\n              await (currentUser as firebase.User).updateProfile({\n                displayName\n              })\n            } else if (!displayName) {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL\n              })\n            } else {\n              await (currentUser as firebase.User).updateProfile({\n                photoURL,\n                displayName\n              })\n            }\n          }\n        }\n      } catch (e) {\n        console.error('fuego AuthGate sign in error', e)\n      }\n    }\n    start()\n  }, [\n    props.signInAnonymously,\n    props.displayName,\n    props.photoURL,\n    props.AuthComponent\n  ])\n\n  if (user === 'loading') return LoadingComponent ? <LoadingComponent /> : null\n\n  if (!user && props.AuthComponent) {\n    const AuthComponent = props.AuthComponent as ComponentType\n\n    return <AuthComponent {...context} {...props} />\n  }\n\n  return <>{props.children}</>\n}\n\nexport default AuthGate\n"]}