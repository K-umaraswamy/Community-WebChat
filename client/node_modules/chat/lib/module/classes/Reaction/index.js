import _regeneratorRuntime from"@babel/runtime/regenerator";import _defineProperty from"@babel/runtime/helpers/defineProperty";import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import Room from'../Room';import{fuego}from'../../components/ChatProvider';var _default=function(){function _default(config){_classCallCheck(this,_default);this.config=config;}_createClass(_default,[{key:"verb",value:function verb(){switch(this.config.reaction){case'like':return{add:'liked',remove:'unliked'};case'love':return{add:'loved',remove:'unloved'};default:{console.warn('reaction type is not valid. see reaction class:',this.config.reaction);return{add:'',remove:''};}}}},{key:"add",value:function add(){var _ref,uid,batch,messageRef,_ref2,roomPath,roomRef;return _regeneratorRuntime.async(function add$(_context){while(1){switch(_context.prev=_context.next){case 0:_ref=fuego.auth().currentUser,uid=_ref.uid;batch=fuego.db.batch();messageRef=fuego.db.doc(this.path);batch.update(messageRef,_defineProperty({},"reactions."+this.config.reaction,fuego.firebase.firestore.FieldValue.arrayUnion(uid)));_ref2=new Room({id:this.config.roomId}),roomPath=_ref2.path;roomRef=fuego.db.doc(roomPath);batch.update(roomRef,{lastMessage:this.makeLastMessage({remove:false})});return _context.abrupt("return",batch.commit());case 8:case"end":return _context.stop();}}},null,this);}},{key:"remove",value:function remove(){var _ref3,uid,batch,messageRef,_ref4,roomPath,roomRef;return _regeneratorRuntime.async(function remove$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_ref3=fuego.auth().currentUser,uid=_ref3.uid;batch=fuego.db.batch();messageRef=fuego.db.doc(this.path);batch.update(messageRef,_defineProperty({},"reactions."+this.config.reaction,fuego.firebase.firestore.FieldValue.arrayRemove(uid)));_ref4=new Room({id:this.config.roomId}),roomPath=_ref4.path;roomRef=fuego.db.doc(roomPath);batch.update(roomRef,{lastMessage:this.makeLastMessage({remove:true})});return _context2.abrupt("return",batch.commit());case 8:case"end":return _context2.stop();}}},null,this);}},{key:"makeReactionDescriptionText",value:function makeReactionDescriptionText(remove){if(this.config.descriptionText===null)return'';var _ref5=fuego.auth().currentUser,displayName=_ref5.displayName;var myName=this.config.myName;var name=myName||displayName||'';var verb=remove?this.verb().remove:this.verb().add;if(this.config.descriptionText){if(typeof this.config.descriptionText==='string')return this.config.descriptionText;if(typeof this.config.descriptionText!=='function'){console.error('üçá Juice Reaction error. The descriptionText property should be either 1) a string or 2) a function that returns a string. Instead, you passed',this.config.descriptionText,' of type ',typeof this.config.descriptionText,'. See the docs or command+hover over the descriptionText property in VS Code to details.');}else{return this.config.descriptionText({reaction:this.config.reaction,name:name||'',text:this.config.text,verb:verb,remove:!!remove});}}var firstName=name&&name.split(' ')[0];var text=firstName+" "+verb+" a message";if(this.config.text){text=firstName+" "+verb+" \""+this.config.text+"\"";}return text;}},{key:"makeLastMessage",value:function makeLastMessage(options){var _ref6=fuego.auth().currentUser,_ref6$displayName=_ref6.displayName,name=_ref6$displayName===void 0?'':_ref6$displayName;return{id:'',createdAt:fuego.firebase.firestore.FieldValue.serverTimestamp(),name:name||'',system:true,text:this.makeReactionDescriptionText(options.remove)};}},{key:"path",get:function get(){var _ref7=new Room({id:this.config.roomId}),messagesPath=_ref7.messagesPath;return messagesPath+"/"+this.config.messageId;}}]);return _default;}();export{_default as default};
//# sourceMappingURL=index.js.map