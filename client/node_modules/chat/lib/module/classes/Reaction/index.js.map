{"version":3,"sources":["index.ts"],"names":["Room","fuego","config","reaction","add","remove","console","warn","auth","currentUser","uid","batch","db","messageRef","doc","path","update","firebase","firestore","FieldValue","arrayUnion","id","roomId","roomPath","roomRef","lastMessage","makeLastMessage","commit","arrayRemove","descriptionText","displayName","myName","name","verb","error","text","firstName","split","options","createdAt","serverTimestamp","system","makeReactionDescriptionText","messagesPath","messageId"],"mappings":"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","sourcesContent":["import { ReactionConfig } from './types'\nimport Room from '../Room'\nimport { fuego } from '../../components/ChatProvider'\nimport { LastMessageServer } from '../Room/types'\n\nexport default class {\n\tprivate config: ReactionConfig\n\tconstructor(config: ReactionConfig) {\n\t\tthis.config = config\n\t}\n\tget path() {\n\t\tconst { messagesPath } = new Room({ id: this.config.roomId })\n\t\treturn `${messagesPath}/${this.config.messageId}`\n\t}\n\tverb(): { add: string; remove: string } {\n\t\tswitch (this.config.reaction) {\n\t\t\tcase 'like':\n\t\t\t\treturn { add: 'liked', remove: 'unliked' }\n\t\t\tcase 'love':\n\t\t\t\treturn { add: 'loved', remove: 'unloved' }\n\t\t\tdefault: {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'reaction type is not valid. see reaction class:',\n\t\t\t\t\tthis.config.reaction\n\t\t\t\t)\n\t\t\t\treturn { add: '', remove: '' }\n\t\t\t}\n\t\t}\n\t}\n\tasync add() {\n\t\tconst { uid } = fuego.auth().currentUser as firebase.User\n\t\tconst batch = fuego.db.batch()\n\t\tconst messageRef = fuego.db.doc(this.path)\n\t\tbatch.update(messageRef, {\n\t\t\t[`reactions.${this.config.reaction}`]: fuego.firebase.firestore.FieldValue.arrayUnion(\n\t\t\t\tuid\n\t\t\t)\n\t\t})\n\t\tconst { path: roomPath } = new Room({ id: this.config.roomId })\n\t\tconst roomRef = fuego.db.doc(roomPath)\n\n\t\tbatch.update(roomRef, {\n\t\t\tlastMessage: this.makeLastMessage({ remove: false })\n\t\t})\n\t\treturn batch.commit()\n\t}\n\tasync remove() {\n\t\tconst { uid } = fuego.auth().currentUser as firebase.User\n\t\tconst batch = fuego.db.batch()\n\t\tconst messageRef = fuego.db.doc(this.path)\n\t\tbatch.update(messageRef, {\n\t\t\t[`reactions.${this.config.reaction}`]: fuego.firebase.firestore.FieldValue.arrayRemove(\n\t\t\t\tuid\n\t\t\t)\n\t\t})\n\t\tconst { path: roomPath } = new Room({ id: this.config.roomId })\n\t\tconst roomRef = fuego.db.doc(roomPath)\n\n\t\tbatch.update(roomRef, {\n\t\t\tlastMessage: this.makeLastMessage({ remove: true })\n\t\t})\n\t\treturn batch.commit()\n\t}\n\tmakeReactionDescriptionText(remove?: boolean): string {\n\t\tif (this.config.descriptionText === null) return ''\n\t\tconst { displayName } = fuego.auth().currentUser as firebase.User\n\t\tconst { myName } = this.config\n\t\tconst name = myName || displayName || ''\n\t\tconst verb = remove ? this.verb().remove : this.verb().add\n\t\tif (this.config.descriptionText) {\n\t\t\tif (typeof this.config.descriptionText === 'string')\n\t\t\t\treturn this.config.descriptionText\n\t\t\tif (typeof this.config.descriptionText !== 'function') {\n\t\t\t\tconsole.error(\n\t\t\t\t\t'üçá Juice Reaction error. The descriptionText property should be either 1) a string or 2) a function that returns a string. Instead, you passed',\n\t\t\t\t\tthis.config.descriptionText,\n\t\t\t\t\t' of type ',\n\t\t\t\t\ttypeof this.config.descriptionText,\n\t\t\t\t\t'. See the docs or command+hover over the descriptionText property in VS Code to details.'\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\treturn this.config.descriptionText({\n\t\t\t\t\treaction: this.config.reaction,\n\t\t\t\t\tname: name || '',\n\t\t\t\t\ttext: this.config.text,\n\t\t\t\t\tverb,\n\t\t\t\t\tremove: !!remove\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t\tconst firstName = name && name.split(' ')[0]\n\t\tlet text = `${firstName} ${verb} a message`\n\t\tif (this.config.text) {\n\t\t\ttext = `${firstName} ${verb} \"${this.config.text}\"`\n\t\t}\n\t\treturn text\n\t}\n\tmakeLastMessage(options: { remove?: boolean }): LastMessageServer {\n\t\tconst { displayName: name = '' } = fuego.auth().currentUser as firebase.User\n\t\treturn {\n\t\t\tid: '',\n\t\t\tcreatedAt: fuego.firebase.firestore.FieldValue.serverTimestamp(),\n\t\t\tname: name || '',\n\t\t\tsystem: true,\n\t\t\ttext: this.makeReactionDescriptionText(options.remove)\n\t\t}\n\t}\n}\n"]}