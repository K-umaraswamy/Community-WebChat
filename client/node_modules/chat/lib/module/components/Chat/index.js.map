{"version":3,"sources":["index.tsx"],"names":["React","useMemo","useRef","useEffect","useCallback","SafeAreaView","View","StyleSheet","Animated","KeyboardAvoidingView","Alert","Clipboard","Transitioning","Transition","Message","Composer","SystemMessage","TypingFooter","Chat","props","checkForBrokenProps","user","name","console","error","id","ref","chatRef","inputRef","flatListRef","componentRef","current","focusInput","focus","blurInput","blur","scrollToEnd","getNode","scrollToIndex","params","scrollToItem","scrollToOffset","transitionRef","mounted","scrollY","animatedScrollNode","Value","onScroll","event","nativeEvent","contentOffset","y","useNativeDriver","messagesRef","messages","latestMessageIsNew","iSentLastMessage","disableScrollToBottomOnSend","offset","scrollToBottomOnAllNewMessages","onViewableItemsChangedRef","onViewableItemsChanged","onViewMessagesRef","onViewMessages","messagesDict","forEach","message","info","visibleMessages","viewableItems","filter","i","isViewable","map","item","latestMessageId","numberOfUsersTyping","namesOfUsersTyping","length","disableTransitions","disableTransitionOnMount","animateNextTransition","onPressMessage","onDoubleTapMessage","onLongPressMessage","onPressItem","onDoubleTapItem","onLongPressItem","text","alert","onPress","setString","style","renderItem","renderMessage","index","system","systemProps","createdAt","textStyle","systemMessageTextStyle","containerStyle","systemMessageContainerStyle","dateToStringFunc","systemMessageDateToStringFunc","dateStyle","systemMessageDateStyle","renderSystemMessage","isMe","messageCreatesNewBunch","isMostRecentMessageInBunch","showName","showNameForEveryMessage","showMyName","showAvatar","showAvatarForEveryMessage","renderAvatar","hideMyAvatar","bubbleStyle","messageContainerStyle","bubbleTextStyle","messageWrapperStyle","bubbleBackgroundColor","bubbleTextColor","initialsBackgroundColor","initialsTextColor","messageProps","delivered","renderFooter","renderMessageFooter","imageProps","read","renderMedia","renderMessageMedia","onLongPress","onDoubleTap","doubleTapDelay","messageDoubleTapDelay","disableSwipeActions","swipeActions","longPressDelay","messageLongPressDelay","avatar","avatarImageProps","avatarSize","renderInitials","nameStyle","tintColor","swipeActionWidth","renderSwipeAction","userId","userName","AvatarImageComponent","mediaHeight","media","height","mediaWidth","width","mediaUri","uri","mediaContentType","contentType","mediaUrl","url","createsNewBunch","renderText","renderMessageText","keyExtractor","typingText","join","renderTypingIndicator","typingIndicatorProps","ListFooterComponent","showTypingText","flatListProps","keyboardDismissMode","keyboardShouldPersistTaps","extraData","contentContainerStyle","renderList","styles","contentContainer","renderHeader","renderComposer","composerProps","onInputTextChanged","initialText","placeholderColor","placeholderText","renderSendButton","renderTextInput","textInputProps","onChangeMedia","onSend","sendButtonMode","composerContainerStyle","inputContainerStyle","inputStyle","sendButtonContainerStyle","sendOnKeyboardReturn","Container","ContainerComponent","safeArea","KeyboardView","avoidKeyboard","transition","transitionConfig","container","append","state","create","flex","flexGrow","marginTop"],"mappings":"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","sourcesContent":["import React, {\n\tuseMemo,\n\tuseRef,\n\tuseEffect,\n\tuseCallback,\n\tMutableRefObject,\n} from 'react'\nimport {\n\tFlatList,\n\tListRenderItemInfo,\n\tSafeAreaView,\n\tView,\n\tStyleSheet,\n\tAnimated,\n\tViewToken,\n\tTextInput,\n\tKeyboardAvoidingView,\n\tAlert,\n\tClipboard,\n} from 'react-native'\nimport {\n\tTransitioning,\n\tTransition,\n\tTransitioningView,\n} from 'react-native-reanimated'\nimport { NewMessageModel } from '../../classes/Message/types'\nimport Message from './Message'\nimport {\n\tChatProps,\n\tMessageProps,\n\tComposerProps,\n\tSystemMessageProps,\n\tChatRef,\n} from './types'\nimport Composer from './Composer'\nimport SystemMessage from './SystemMessage'\nimport TypingFooter from './TypingFooter'\n\nfunction Chat<MessageModel extends NewMessageModel = NewMessageModel>(\n\tprops: ChatProps<MessageModel>\n) {\n\tconst checkForBrokenProps = () => {\n\t\tif (!props.user.name) {\n\t\t\tconsole.error(\n\t\t\t\t'Breaking error: Messages component is missing a name in the user prop.'\n\t\t\t)\n\t\t}\n\t\tif (!props.user.id) {\n\t\t\tconsole.error(\n\t\t\t\t'Breaking error: Messages component is missing an id in the user prop.'\n\t\t\t)\n\t\t}\n\t}\n\tcheckForBrokenProps()\n\t// \"constructor\" variables\n\tconst { chatRef: ref } = props\n\tconst inputRef = useRef<TextInput>()\n\tconst flatListRef = useRef<typeof Animated.ScrollView>()\n\t// const flatListRef = useRef<typeof Animated.FlatList<MessageModel>>()\n\tconst componentRef = useRef<ChatRef<MessageModel>>()\n\n\tuseEffect(() => {\n\t\tcomponentRef.current = {\n\t\t\tfocusInput: () => inputRef.current?.focus(),\n\t\t\tblurInput: () => inputRef.current?.blur(),\n\t\t\tscrollToEnd: () => flatListRef.current?.getNode().scrollToEnd(),\n\t\t\tscrollToIndex: params =>\n\t\t\t\tflatListRef.current?.getNode().scrollToIndex(params),\n\t\t\tscrollToItem: params =>\n\t\t\t\tflatListRef.current?.getNode().scrollToItem(params),\n\t\t\tscrollToOffset: params =>\n\t\t\t\tflatListRef.current?.getNode().scrollToOffset(params),\n\t\t}\n\t\tif (ref) ref.current = componentRef.current\n\t})\n\n\t// if (!componentRef.current) {\n\t// \tcomponentRef.current = {\n\t// \t\tfocusInput: () => inputRef.current && inputRef.current.focus(),\n\t// \t\tblurInput: () => inputRef.current && inputRef.current.blur(),\n\t// \t\tscrollToEnd: () =>\n\t// \t\t\tflatListRef.current && flatListRef.current.getNode().scrollToEnd(),\n\t// \t\tscrollToIndex: params =>\n\t// \t\t\tflatListRef.current &&\n\t// \t\t\tflatListRef.current.getNode().scrollToIndex(params),\n\t// \t\tscrollToItem: params =>\n\t// \t\t\tflatListRef.current &&\n\t// \t\t\tflatListRef.current.getNode().scrollToItem(params),\n\t// \t\tscrollToOffset: params =>\n\t// \t\t\tflatListRef.current &&\n\t// \t\t\tflatListRef.current.getNode().scrollToOffset(params),\n\t// \t}\n\t// \tif (ref) ref.current = componentRef.current\n\t// }\n\n\t// used to shuffle/transition the inbox when it changes\n\tconst transitionRef = useRef<TransitioningView>(null)\n\tconst mounted = useRef(false)\n\n\t// track animated position of scroll\n\tconst scrollY: Animated.Value = useMemo(\n\t\t() => props.animatedScrollNode || new Animated.Value(0),\n\t\t[props.animatedScrollNode]\n\t)\n\n\t// upate position of scroll variable\n\tconst onScroll = Animated.event(\n\t\t[{ nativeEvent: { contentOffset: { y: scrollY } } }],\n\t\t{ useNativeDriver: true }\n\t)\n\n\tconst messagesRef = useRef(props.messages)\n\n\t// effect to handle new messages coming in / scrolling to bottom\n\t// TODO we may have to use getNode() for the animated flatlist, right?\n\tuseEffect(() => {\n\t\tconst latestMessageIsNew =\n\t\t\t(props.messages[0] && props.messages[0].id) !==\n\t\t\t(messagesRef.current[0] && messagesRef.current[0].id)\n\t\t// const numberOfMessagesIncreased =\n\t\t// \tprops.messages.length > messagesRef.current.length\n\t\tif (\n\t\t\tlatestMessageIsNew &&\n\t\t\t// numberOfMessagesIncreased &&\n\t\t\tflatListRef.current\n\t\t) {\n\t\t\tconst iSentLastMessage =\n\t\t\t\tprops.messages[0] &&\n\t\t\t\tprops.messages[0].user &&\n\t\t\t\tprops.messages[0].user.id === props.user.id\n\t\t\tif (iSentLastMessage && !props.disableScrollToBottomOnSend)\n\t\t\t\tflatListRef.current.getNode().scrollToOffset({ offset: 0 })\n\t\t\telse if (props.scrollToBottomOnAllNewMessages)\n\t\t\t\tflatListRef.current.getNode().scrollToOffset({ offset: 0 })\n\t\t}\n\t}, [\n\t\tprops.disableScrollToBottomOnSend,\n\t\tprops.scrollToBottomOnAllNewMessages,\n\t\tprops.messages,\n\t\tprops.user.id,\n\t])\n\n\t// ðŸ’© a super way of handling viewable items not on the fly. (easy way to track viewed messages)\n\t// TODO abstract this to a different custom hook.\n\tconst onViewableItemsChangedRef = useRef(props.onViewableItemsChanged)\n\tconst onViewMessagesRef = useRef(props.onViewMessages)\n\t// track the messages in a non-array too for fast querying.\n\tconst messagesDict = useRef<{ [id: string]: MessageModel }>({})\n\t// ...onto the effect ðŸ˜…\n\tuseEffect(() => {\n\t\t// make updated methods available to onviewable items changed\n\t\tonViewableItemsChangedRef.current = props.onViewableItemsChanged\n\t\tonViewMessagesRef.current = props.onViewMessages\n\t\tmessagesRef.current = props.messages\n\t\tmessagesDict.current = {}\n\t\tif (props.messages) {\n\t\t\tprops.messages.forEach(message => {\n\t\t\t\tmessagesDict.current[message.id] = message\n\t\t\t})\n\t\t}\n\t}, [props.onViewableItemsChanged, props.onViewMessages, props.messages])\n\n\tconst onViewableItemsChanged: FlatList<\n\t\tMessageModel\n\t>['props']['onViewableItemsChanged'] = useCallback(\n\t\t(info: { viewableItems: ViewToken[]; changed: ViewToken[] }) => {\n\t\t\tif (onViewableItemsChangedRef.current)\n\t\t\t\tonViewableItemsChangedRef.current(info)\n\n\t\t\tif (onViewMessagesRef.current) {\n\t\t\t\tconst visibleMessages = info.viewableItems\n\t\t\t\t\t.filter(i => i.isViewable)\n\t\t\t\t\t.map(i => i.item)\n\t\t\t\tconst latestMessageId =\n\t\t\t\t\tmessagesRef.current &&\n\t\t\t\t\tmessagesRef.current[0] &&\n\t\t\t\t\tmessagesRef.current[0].id\n\t\t\t\tonViewMessagesRef.current({\n\t\t\t\t\tvisibleMessages,\n\t\t\t\t\tlatestMessageId,\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t[]\n\t)\n\t// END OF THAT ðŸ’©\n\n\tconst numberOfUsersTyping = useMemo(\n\t\t() => props.namesOfUsersTyping?.length ?? 0,\n\t\t[props.namesOfUsersTyping]\n\t)\n\t// effect to handle animating the screen if the messages changed or people typing just changed\n\tuseEffect(() => {\n\t\tif (\n\t\t\t!props.disableTransitions &&\n\t\t\t// if we've already mounted, or we want to transition even if we haven't...\n\t\t\t(mounted.current || !props.disableTransitionOnMount) &&\n\t\t\t// and assuming the transition component is initialized...\n\t\t\ttransitionRef.current\n\t\t)\n\t\t\t// animate\n\t\t\ttransitionRef.current.animateNextTransition()\n\t\telse mounted.current = true\n\t}, [\n\t\tprops.disableTransitionOnMount,\n\t\tnumberOfUsersTyping,\n\t\tprops.messages,\n\t\tprops.disableTransitions,\n\t])\n\n\tconst { onPressMessage, onDoubleTapMessage, onLongPressMessage } = props\n\tconst onPressItem = useCallback(\n\t\tid => {\n\t\t\tconst message = messagesDict.current?.[id]\n\t\t\tif (onPressMessage) onPressMessage(message)\n\t\t},\n\t\t[onPressMessage]\n\t)\n\n\tconst onDoubleTapItem = useCallback(\n\t\tid => {\n\t\t\tconst message = messagesDict.current?.[id]\n\t\t\tif (onDoubleTapMessage) onDoubleTapMessage(message)\n\t\t},\n\t\t[onDoubleTapMessage]\n\t)\n\n\tconst onLongPressItem = useCallback(\n\t\tid => {\n\t\t\tconst message = messagesDict.current?.[id]\n\t\t\tif (onLongPressMessage) return onLongPressMessage(message)\n\t\t\tif (message && message.text) {\n\t\t\t\tAlert.alert('Message', message.text, [\n\t\t\t\t\t{\n\t\t\t\t\t\ttext: 'Copy text',\n\t\t\t\t\t\tonPress: () => {\n\t\t\t\t\t\t\tClipboard.setString(message.text)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tstyle: 'cancel',\n\t\t\t\t\t},\n\t\t\t\t\t{ text: 'Go back' },\n\t\t\t\t])\n\t\t\t}\n\t\t},\n\t\t[onLongPressMessage]\n\t)\n\n\tconst renderItem = (info: ListRenderItemInfo<MessageModel>) => {\n\t\tif (props.renderItem) return props.renderItem(info)\n\t\tif (props.renderMessage === null) return null\n\n\t\tconst { item: message, index } = info\n\n\t\tif (message.system) {\n\t\t\tconst systemProps: SystemMessageProps = {\n\t\t\t\ttext: message.text,\n\t\t\t\tcreatedAt: message.createdAt,\n\t\t\t\ttextStyle: props.systemMessageTextStyle,\n\t\t\t\tcontainerStyle: props.systemMessageContainerStyle,\n\t\t\t\tdateToStringFunc: props.systemMessageDateToStringFunc,\n\t\t\t\tdateStyle: props.systemMessageDateStyle,\n\t\t\t}\n\n\t\t\tif (props.renderSystemMessage === null) return null\n\t\t\tif (props.renderSystemMessage)\n\t\t\t\treturn props.renderSystemMessage(systemProps)\n\n\t\t\treturn <SystemMessage {...systemProps} />\n\t\t}\n\n\t\tconst isMe = message.user.id === props.user.id\n\n\t\t// indicates that the previous message was sent by someone else, so this starts a new bunch\n\t\tconst messageCreatesNewBunch = !(\n\t\t\tprops.messages[index + 1] &&\n\t\t\tprops.messages[index + 1].user &&\n\t\t\tprops.messages[index + 1].user.id ===\n\t\t\t\t(props.messages[index] &&\n\t\t\t\t\tprops.messages[index].user &&\n\t\t\t\t\tprops.messages[index].user.id)\n\t\t)\n\n\t\tconst isMostRecentMessageInBunch = !(\n\t\t\tprops.messages[index - 1] &&\n\t\t\tprops.messages[index - 1].user &&\n\t\t\tprops.messages[index - 1].user.id ===\n\t\t\t\t(props.messages[index] &&\n\t\t\t\t\tprops.messages[index].user &&\n\t\t\t\t\tprops.messages[index].user.id)\n\t\t)\n\n\t\t// show name if the previous message was sent by someone else\n\t\t// also, only show my own name if specified, since that's kinda weird to show my own. beat my dribble\n\t\tlet showName = props.showNameForEveryMessage || messageCreatesNewBunch\n\t\tif (isMe && !props.showMyName) showName = false\n\n\t\t// by default, only show avatar for a the bottom of a bunch\n\t\tconst showAvatar =\n\t\t\tprops.showAvatarForEveryMessage || isMostRecentMessageInBunch\n\t\tlet renderAvatar = props.renderAvatar\n\t\t// and we hide the avatar if we say to\n\t\tif (isMe && props.hideMyAvatar) {\n\t\t\t// showAvatar = false\n\t\t\trenderAvatar = null\n\t\t}\n\n\t\tconst bubbleStyle = props.bubbleStyle?.({ isMe })\n\t\tconst messageContainerStyle = props.messageContainerStyle?.({ isMe })\n\t\tconst bubbleTextStyle = props.bubbleTextStyle?.({ isMe })\n\t\tconst messageWrapperStyle = props.messageWrapperStyle?.({ isMe })\n\t\tconst bubbleBackgroundColor = props.bubbleBackgroundColor?.({ isMe })\n\t\tconst bubbleTextColor = props.bubbleTextColor?.({ isMe })\n\t\tconst initialsBackgroundColor = props.initialsBackgroundColor?.({ isMe })\n\t\tconst initialsTextColor = props.initialsTextColor?.({ isMe })\n\n\t\tconst messageProps: MessageProps = {\n\t\t\tmessageContainerStyle,\n\t\t\tbubbleStyle,\n\t\t\tbubbleTextStyle,\n\t\t\tmessageWrapperStyle,\n\t\t\tdelivered: true,\n\t\t\t// isMe: (message.user && message.user.id) === (props.user && props.user.id),\n\t\t\tisMe,\n\t\t\trenderFooter: props.renderMessageFooter,\n\t\t\timageProps: props.imageProps,\n\t\t\t// media: message.media,\n\t\t\tname: message.user.name,\n\t\t\tsystem: message.system,\n\t\t\ttext: message.text,\n\t\t\tread: true,\n\t\t\trenderMedia: props.renderMessageMedia,\n\t\t\tonLongPress: onLongPressItem,\n\t\t\tonPress: onPressItem,\n\t\t\t// pressType: props.messagePressType || 'double',\n\t\t\tonDoubleTap: onDoubleTapItem,\n\t\t\tdoubleTapDelay: props.messageDoubleTapDelay,\n\t\t\tdisableSwipeActions: props.disableSwipeActions,\n\t\t\tswipeActions: props.swipeActions,\n\t\t\tlongPressDelay: props.messageLongPressDelay,\n\t\t\tid: message.id,\n\t\t\tshowName,\n\t\t\tavatar: message.user.avatar,\n\t\t\tavatarImageProps: props.avatarImageProps,\n\t\t\tavatarSize: props.avatarSize,\n\t\t\trenderAvatar,\n\t\t\tshowAvatar,\n\t\t\t// initialsBackgroundColor: props.initialsBackgroundColor,\n\t\t\t// initialsTextColor: props.initialsTextColor,\n\t\t\tinitialsBackgroundColor,\n\t\t\tinitialsTextColor,\n\t\t\trenderInitials: props.renderInitials,\n\t\t\tnameStyle: props.nameStyle,\n\t\t\ttintColor: props.tintColor,\n\t\t\tswipeActionWidth: props.swipeActionWidth,\n\t\t\trenderSwipeAction: props.renderSwipeAction,\n\t\t\tbubbleBackgroundColor,\n\t\t\tbubbleTextColor,\n\t\t\tuserId: message.user.id,\n\t\t\tuserName: message.user.name,\n\t\t\tAvatarImageComponent: props.AvatarImageComponent,\n\t\t\tmediaHeight: message.media?.height,\n\t\t\tmediaWidth: message.media?.width,\n\t\t\tmediaUri: message.media?.uri,\n\t\t\tmediaContentType: message.media?.contentType,\n\t\t\tmediaUrl: message.media?.url,\n\t\t\tcreatesNewBunch: messageCreatesNewBunch,\n\t\t\trenderText: props.renderMessageText,\n\t\t\tcreatedAt: message.createdAt,\n\t\t}\n\n\t\tif (props.renderMessage) return props.renderMessage(messageProps)\n\t\treturn <Message {...messageProps} />\n\t}\n\t// \t,\n\t// \t[\n\t// \t\tprops.tintColor,\n\t// \t\tprops.user,\n\t// \t\tprops.renderItem,\n\t// \t\tprops.renderMessage,\n\t// \t\tprops.renderMessageFooter,\n\t// \t\tprops.renderSystemMessage,\n\t// \t\tprops.renderMessageMedia,\n\t// \t\tprops.onPressMessage,\n\t// \t\tprops.systemMessageContainerStyle,\n\t// \t\tprops.systemMessageDateToStringFunc,\n\t// \t\tprops.systemMessageDateStyle,\n\t// \t\tprops.systemMessageTextStyle,\n\t// \t\tprops.messages,\n\t// \t\tprops.showNameForEveryMessage,\n\t// \t\tprops.showMyName,\n\t// \t\tprops.showAvatarForEveryMessage,\n\t// \t\tprops.renderAvatar,\n\t// \t\tprops.hideMyAvatar,\n\t// \t\tprops.bubbleStyle,\n\t// \t\tprops.messageContainerStyle,\n\t// \t\tprops.bubbleTextStyle,\n\t// \t\tprops.messageWrapperStyle,\n\t// \t\tprops.bubbleBackgroundColor,\n\t// \t\tprops.bubbleTextStyle,\n\t// \t\tprops.bubbleTextColor,\n\t// \t\tprops.renderMessageFooter,\n\t// \t\tprops.imageProps,\n\t// \t\tprops.onLongPressMessage,\n\t// \t\tprops.messagePressType,\n\t// \t\tprops.onPressMessage,\n\t// \t\tprops.messageDoubleTapDelay,\n\t// \t\tprops.disableSwipeActions,\n\t// \t\tprops.swipeActionWidth,\n\t// \t\tprops.swipeActions,\n\t// \t\tprops.messageLongPressDelay,\n\t// \t\tprops.avatarImageProps,\n\t// \t\tprops.avatarSize,\n\t// \t\tprops.initialsBackgroundColor,\n\t// \t\tprops.initialsTextColor,\n\t// \t\tprops.renderInitials,\n\t// \t\tprops.nameStyle,\n\t// \t\tprops.swipeActionWidth,\n\t// \t\tprops.AvatarImageComponent,\n\t// \t],\n\t// )\n\n\tconst keyExtractor = useMemo(\n\t\t() => props.keyExtractor || (({ id }: MessageModel) => id),\n\t\t[props.keyExtractor]\n\t)\n\tconst namesOfUsersTyping = useMemo(() => props.namesOfUsersTyping || [], [\n\t\tprops.namesOfUsersTyping,\n\t])\n\n\tconst typingText = namesOfUsersTyping.join(', ')\n\n\tconst { renderTypingIndicator, typingIndicatorProps } = props\n\tconst ListFooterComponent = useCallback(() => {\n\t\tif (renderTypingIndicator === null || !numberOfUsersTyping) return null\n\n\t\treturn (\n\t\t\t<TypingFooter\n\t\t\t\ttypingText={props.showTypingText ? typingText : ''}\n\t\t\t\tnumberOfUsersTyping={numberOfUsersTyping}\n\t\t\t\t{...typingIndicatorProps}\n\t\t\t/>\n\t\t)\n\t}, [\n\t\ttypingText,\n\t\tprops.showTypingText,\n\t\trenderTypingIndicator,\n\t\tnumberOfUsersTyping,\n\t\ttypingIndicatorProps,\n\t])\n\n\tconst {\n\t\tflatListProps,\n\t\tkeyboardDismissMode = 'interactive',\n\t\tkeyboardShouldPersistTaps = 'handled',\n\t\textraData,\n\t\tmessages,\n\t\tcontentContainerStyle,\n\t} = props\n\tconst renderList = () => {\n\t\treturn (\n\t\t\t<Animated.FlatList\n\t\t\t\t{...flatListProps}\n\t\t\t\tref={flatListRef as MutableRefObject<FlatList<MessageModel>>}\n\t\t\t\tdata={messages}\n\t\t\t\tkeyExtractor={keyExtractor}\n\t\t\t\trenderItem={renderItem}\n\t\t\t\textraData={extraData}\n\t\t\t\tListHeaderComponent={ListFooterComponent}\n\t\t\t\tinverted\n\t\t\t\t// initialNum\n\t\t\t\tonScroll={onScroll}\n\t\t\t\tonViewableItemsChanged={onViewableItemsChanged}\n\t\t\t\tkeyboardShouldPeristTaps={keyboardShouldPersistTaps}\n\t\t\t\tkeyboardDismissMode={keyboardDismissMode}\n\t\t\t\tcontentContainerStyle={{\n\t\t\t\t\t...styles.contentContainer,\n\t\t\t\t\t...(contentContainerStyle || {}),\n\t\t\t\t}}\n\t\t\t\tinitialNumToRender={20}\n\t\t\t/>\n\t\t)\n\t}\n\t// , [\n\t// \tflatListProps,\n\t// \tkeyboardDismissMode,\n\t// \tkeyboardShouldPersistTaps,\n\t// \textraData,\n\t// \tmessages,\n\t// \tonViewableItemsChanged,\n\t// \tListFooterComponent,\n\t// \tonScroll,\n\t// \tkeyExtractor,\n\t// \trenderItem,\n\t// \tcontentContainerStyle,\n\t// ])\n\tconst renderHeader = () => {\n\t\tif (props.renderHeader) return props.renderHeader()\n\t\treturn null\n\t}\n\tconst renderFooter = () => {\n\t\tif (props.renderFooter) return props.renderFooter()\n\t\treturn null\n\t}\n\tconst renderComposer = () => {\n\t\tif (props.renderComposer === null) return null\n\n\t\tconst composerProps: ComposerProps = {\n\t\t\tonInputTextChanged: props.onInputTextChanged,\n\t\t\ttext: props.text,\n\t\t\tinitialText: props.initialText,\n\t\t\tplaceholderColor: props.placeholderColor,\n\t\t\tplaceholderText: props.placeholderText,\n\t\t\trenderSendButton: props.renderSendButton,\n\t\t\trenderTextInput: props.renderTextInput,\n\t\t\ttextInputProps: props.textInputProps,\n\t\t\tmedia: props.media,\n\t\t\tonChangeMedia: props.onChangeMedia,\n\t\t\tuser: props.user,\n\t\t\tonSend: props.onSend,\n\t\t\tsendButtonMode: props.sendButtonMode,\n\t\t\tcontainerStyle: props.composerContainerStyle,\n\t\t\tinputContainerStyle: props.inputContainerStyle,\n\t\t\tinputStyle: props.inputStyle,\n\t\t\ttintColor: props.tintColor,\n\t\t\tinputRef: inputRef as MutableRefObject<TextInput>,\n\t\t\tsendButtonContainerStyle: props.sendButtonContainerStyle,\n\t\t\tsendOnKeyboardReturn: props.sendOnKeyboardReturn,\n\t\t}\n\t\tif (props.renderComposer) return props.renderComposer(composerProps)\n\n\t\treturn <Composer {...composerProps} />\n\t}\n\n\t// now, onto the actual render code\n\tconst Container =\n\t\tprops.ContainerComponent || (props.safeArea ? SafeAreaView : View)\n\tconst KeyboardView =\n\t\tprops.avoidKeyboard === false ? View : KeyboardAvoidingView\n\n\t// reanimated transition\n\tconst transition = useMemo(\n\t\t() =>\n\t\t\tprops.transitionConfig ||\n\t\t\t(true && (\n\t\t\t\t<Transition.Together>\n\t\t\t\t\t{/* <Transition.Out type=\"fade\" durationMs={100} /> */}\n\t\t\t\t\t<Transition.Change interpolation=\"easeInOut\" />\n\t\t\t\t\t<Transition.In type=\"fade\" />\n\t\t\t\t</Transition.Together>\n\t\t\t)),\n\t\t[props.transitionConfig]\n\t)\n\tconst containerStyle = useMemo(\n\t\t() => ({\n\t\t\t...styles.container,\n\t\t\t...props.containerStyle,\n\t\t}),\n\t\t[props.containerStyle]\n\t)\n\treturn (\n\t\t<Transitioning.View\n\t\t\tref={transitionRef}\n\t\t\ttransition={transition}\n\t\t\tstyle={containerStyle}\n\t\t>\n\t\t\t<Container style={containerStyle}>\n\t\t\t\t<KeyboardView\n\t\t\t\t\tstyle={containerStyle}\n\t\t\t\t\t// behavior={Platform.OS === 'ios' ? 'padding' : undefined}\n\t\t\t\t\tbehavior=\"padding\"\n\t\t\t\t>\n\t\t\t\t\t{renderHeader()}\n\t\t\t\t\t{renderList()}\n\t\t\t\t\t{renderFooter()}\n\t\t\t\t\t{renderComposer()}\n\t\t\t\t</KeyboardView>\n\t\t\t</Container>\n\t\t</Transitioning.View>\n\t)\n}\n\nChat.append = function<M>(state: M[], messages: M[]) {\n\treturn [...messages, ...state]\n}\n\nexport default Chat\n\nconst styles = StyleSheet.create({\n\tcontainer: {\n\t\tflex: 1,\n\t},\n\tcontentContainer: {\n\t\tflexGrow: 1,\n\t\tmarginTop: 5,\n\t},\n})\n"]}