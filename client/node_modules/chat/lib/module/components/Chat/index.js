import _toConsumableArray from"@babel/runtime/helpers/toConsumableArray";import _defineProperty from"@babel/runtime/helpers/defineProperty";import _extends from"@babel/runtime/helpers/extends";var _jsxFileName="/Users/Fernando/Developer/Learning Babel/usechat/src/components/Chat/index.tsx";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React,{useMemo,useRef,useEffect,useCallback}from'react';import{SafeAreaView,View,StyleSheet,Animated,KeyboardAvoidingView,Alert,Clipboard}from'react-native';import{Transitioning,Transition}from'react-native-reanimated';import Message from'./Message';import Composer from'./Composer';import SystemMessage from'./SystemMessage';import TypingFooter from'./TypingFooter';function Chat(props){var checkForBrokenProps=function checkForBrokenProps(){if(!props.user.name){console.error('Breaking error: Messages component is missing a name in the user prop.');}if(!props.user.id){console.error('Breaking error: Messages component is missing an id in the user prop.');}};checkForBrokenProps();var ref=props.chatRef;var inputRef=useRef();var flatListRef=useRef();var componentRef=useRef();useEffect(function(){componentRef.current={focusInput:function focusInput(){var _inputRef$current;return(_inputRef$current=inputRef.current)==null?void 0:_inputRef$current.focus();},blurInput:function blurInput(){var _inputRef$current2;return(_inputRef$current2=inputRef.current)==null?void 0:_inputRef$current2.blur();},scrollToEnd:function scrollToEnd(){var _flatListRef$current;return(_flatListRef$current=flatListRef.current)==null?void 0:_flatListRef$current.getNode().scrollToEnd();},scrollToIndex:function scrollToIndex(params){var _flatListRef$current2;return(_flatListRef$current2=flatListRef.current)==null?void 0:_flatListRef$current2.getNode().scrollToIndex(params);},scrollToItem:function scrollToItem(params){var _flatListRef$current3;return(_flatListRef$current3=flatListRef.current)==null?void 0:_flatListRef$current3.getNode().scrollToItem(params);},scrollToOffset:function scrollToOffset(params){var _flatListRef$current4;return(_flatListRef$current4=flatListRef.current)==null?void 0:_flatListRef$current4.getNode().scrollToOffset(params);}};if(ref)ref.current=componentRef.current;});var transitionRef=useRef(null);var mounted=useRef(false);var scrollY=useMemo(function(){return props.animatedScrollNode||new Animated.Value(0);},[props.animatedScrollNode]);var onScroll=Animated.event([{nativeEvent:{contentOffset:{y:scrollY}}}],{useNativeDriver:true});var messagesRef=useRef(props.messages);useEffect(function(){var latestMessageIsNew=(props.messages[0]&&props.messages[0].id)!==(messagesRef.current[0]&&messagesRef.current[0].id);if(latestMessageIsNew&&flatListRef.current){var iSentLastMessage=props.messages[0]&&props.messages[0].user&&props.messages[0].user.id===props.user.id;if(iSentLastMessage&&!props.disableScrollToBottomOnSend)flatListRef.current.getNode().scrollToOffset({offset:0});else if(props.scrollToBottomOnAllNewMessages)flatListRef.current.getNode().scrollToOffset({offset:0});}},[props.disableScrollToBottomOnSend,props.scrollToBottomOnAllNewMessages,props.messages,props.user.id]);var onViewableItemsChangedRef=useRef(props.onViewableItemsChanged);var onViewMessagesRef=useRef(props.onViewMessages);var messagesDict=useRef({});useEffect(function(){onViewableItemsChangedRef.current=props.onViewableItemsChanged;onViewMessagesRef.current=props.onViewMessages;messagesRef.current=props.messages;messagesDict.current={};if(props.messages){props.messages.forEach(function(message){messagesDict.current[message.id]=message;});}},[props.onViewableItemsChanged,props.onViewMessages,props.messages]);var onViewableItemsChanged=useCallback(function(info){if(onViewableItemsChangedRef.current)onViewableItemsChangedRef.current(info);if(onViewMessagesRef.current){var visibleMessages=info.viewableItems.filter(function(i){return i.isViewable;}).map(function(i){return i.item;});var latestMessageId=messagesRef.current&&messagesRef.current[0]&&messagesRef.current[0].id;onViewMessagesRef.current({visibleMessages:visibleMessages,latestMessageId:latestMessageId});}},[]);var numberOfUsersTyping=useMemo(function(){var _ref,_props$namesOfUsersTy;return(_ref=(_props$namesOfUsersTy=props.namesOfUsersTyping)==null?void 0:_props$namesOfUsersTy.length)!=null?_ref:0;},[props.namesOfUsersTyping]);useEffect(function(){if(!props.disableTransitions&&(mounted.current||!props.disableTransitionOnMount)&&transitionRef.current)transitionRef.current.animateNextTransition();else mounted.current=true;},[props.disableTransitionOnMount,numberOfUsersTyping,props.messages,props.disableTransitions]);var onPressMessage=props.onPressMessage,onDoubleTapMessage=props.onDoubleTapMessage,onLongPressMessage=props.onLongPressMessage;var onPressItem=useCallback(function(id){var _messagesDict$current;var message=(_messagesDict$current=messagesDict.current)==null?void 0:_messagesDict$current[id];if(onPressMessage)onPressMessage(message);},[onPressMessage]);var onDoubleTapItem=useCallback(function(id){var _messagesDict$current2;var message=(_messagesDict$current2=messagesDict.current)==null?void 0:_messagesDict$current2[id];if(onDoubleTapMessage)onDoubleTapMessage(message);},[onDoubleTapMessage]);var onLongPressItem=useCallback(function(id){var _messagesDict$current3;var message=(_messagesDict$current3=messagesDict.current)==null?void 0:_messagesDict$current3[id];if(onLongPressMessage)return onLongPressMessage(message);if(message&&message.text){Alert.alert('Message',message.text,[{text:'Copy text',onPress:function onPress(){Clipboard.setString(message.text);},style:'cancel'},{text:'Go back'}]);}},[onLongPressMessage]);var renderItem=function renderItem(info){var _message$media,_message$media2,_message$media3,_message$media4,_message$media5;if(props.renderItem)return props.renderItem(info);if(props.renderMessage===null)return null;var message=info.item,index=info.index;if(message.system){var systemProps={text:message.text,createdAt:message.createdAt,textStyle:props.systemMessageTextStyle,containerStyle:props.systemMessageContainerStyle,dateToStringFunc:props.systemMessageDateToStringFunc,dateStyle:props.systemMessageDateStyle};if(props.renderSystemMessage===null)return null;if(props.renderSystemMessage)return props.renderSystemMessage(systemProps);return React.createElement(SystemMessage,_extends({},systemProps,{__source:{fileName:_jsxFileName,lineNumber:268}}));}var isMe=message.user.id===props.user.id;var messageCreatesNewBunch=!(props.messages[index+1]&&props.messages[index+1].user&&props.messages[index+1].user.id===(props.messages[index]&&props.messages[index].user&&props.messages[index].user.id));var isMostRecentMessageInBunch=!(props.messages[index-1]&&props.messages[index-1].user&&props.messages[index-1].user.id===(props.messages[index]&&props.messages[index].user&&props.messages[index].user.id));var showName=props.showNameForEveryMessage||messageCreatesNewBunch;if(isMe&&!props.showMyName)showName=false;var showAvatar=props.showAvatarForEveryMessage||isMostRecentMessageInBunch;var renderAvatar=props.renderAvatar;if(isMe&&props.hideMyAvatar){renderAvatar=null;}var bubbleStyle=props.bubbleStyle==null?void 0:props.bubbleStyle({isMe:isMe});var messageContainerStyle=props.messageContainerStyle==null?void 0:props.messageContainerStyle({isMe:isMe});var bubbleTextStyle=props.bubbleTextStyle==null?void 0:props.bubbleTextStyle({isMe:isMe});var messageWrapperStyle=props.messageWrapperStyle==null?void 0:props.messageWrapperStyle({isMe:isMe});var bubbleBackgroundColor=props.bubbleBackgroundColor==null?void 0:props.bubbleBackgroundColor({isMe:isMe});var bubbleTextColor=props.bubbleTextColor==null?void 0:props.bubbleTextColor({isMe:isMe});var initialsBackgroundColor=props.initialsBackgroundColor==null?void 0:props.initialsBackgroundColor({isMe:isMe});var initialsTextColor=props.initialsTextColor==null?void 0:props.initialsTextColor({isMe:isMe});var messageProps={messageContainerStyle:messageContainerStyle,bubbleStyle:bubbleStyle,bubbleTextStyle:bubbleTextStyle,messageWrapperStyle:messageWrapperStyle,delivered:true,isMe:isMe,renderFooter:props.renderMessageFooter,imageProps:props.imageProps,name:message.user.name,system:message.system,text:message.text,read:true,renderMedia:props.renderMessageMedia,onLongPress:onLongPressItem,onPress:onPressItem,onDoubleTap:onDoubleTapItem,doubleTapDelay:props.messageDoubleTapDelay,disableSwipeActions:props.disableSwipeActions,swipeActions:props.swipeActions,longPressDelay:props.messageLongPressDelay,id:message.id,showName:showName,avatar:message.user.avatar,avatarImageProps:props.avatarImageProps,avatarSize:props.avatarSize,renderAvatar:renderAvatar,showAvatar:showAvatar,initialsBackgroundColor:initialsBackgroundColor,initialsTextColor:initialsTextColor,renderInitials:props.renderInitials,nameStyle:props.nameStyle,tintColor:props.tintColor,swipeActionWidth:props.swipeActionWidth,renderSwipeAction:props.renderSwipeAction,bubbleBackgroundColor:bubbleBackgroundColor,bubbleTextColor:bubbleTextColor,userId:message.user.id,userName:message.user.name,AvatarImageComponent:props.AvatarImageComponent,mediaHeight:(_message$media=message.media)==null?void 0:_message$media.height,mediaWidth:(_message$media2=message.media)==null?void 0:_message$media2.width,mediaUri:(_message$media3=message.media)==null?void 0:_message$media3.uri,mediaContentType:(_message$media4=message.media)==null?void 0:_message$media4.contentType,mediaUrl:(_message$media5=message.media)==null?void 0:_message$media5.url,createsNewBunch:messageCreatesNewBunch,renderText:props.renderMessageText,createdAt:message.createdAt};if(props.renderMessage)return props.renderMessage(messageProps);return React.createElement(Message,_extends({},messageProps,{__source:{fileName:_jsxFileName,lineNumber:372}}));};var keyExtractor=useMemo(function(){return props.keyExtractor||function(_ref2){var id=_ref2.id;return id;};},[props.keyExtractor]);var namesOfUsersTyping=useMemo(function(){return props.namesOfUsersTyping||[];},[props.namesOfUsersTyping]);var typingText=namesOfUsersTyping.join(', ');var renderTypingIndicator=props.renderTypingIndicator,typingIndicatorProps=props.typingIndicatorProps;var ListFooterComponent=useCallback(function(){if(renderTypingIndicator===null||!numberOfUsersTyping)return null;return React.createElement(TypingFooter,_extends({typingText:props.showTypingText?typingText:'',numberOfUsersTyping:numberOfUsersTyping},typingIndicatorProps,{__source:{fileName:_jsxFileName,lineNumber:437}}));},[typingText,props.showTypingText,renderTypingIndicator,numberOfUsersTyping,typingIndicatorProps]);var flatListProps=props.flatListProps,_props$keyboardDismis=props.keyboardDismissMode,keyboardDismissMode=_props$keyboardDismis===void 0?'interactive':_props$keyboardDismis,_props$keyboardShould=props.keyboardShouldPersistTaps,keyboardShouldPersistTaps=_props$keyboardShould===void 0?'handled':_props$keyboardShould,extraData=props.extraData,messages=props.messages,contentContainerStyle=props.contentContainerStyle;var renderList=function renderList(){return React.createElement(Animated.FlatList,_extends({},flatListProps,{ref:flatListRef,data:messages,keyExtractor:keyExtractor,renderItem:renderItem,extraData:extraData,ListHeaderComponent:ListFooterComponent,inverted:true,onScroll:onScroll,onViewableItemsChanged:onViewableItemsChanged,keyboardShouldPeristTaps:keyboardShouldPersistTaps,keyboardDismissMode:keyboardDismissMode,contentContainerStyle:_objectSpread({},styles.contentContainer,{},contentContainerStyle||{}),initialNumToRender:20,__source:{fileName:_jsxFileName,lineNumber:461}}));};var renderHeader=function renderHeader(){if(props.renderHeader)return props.renderHeader();return null;};var renderFooter=function renderFooter(){if(props.renderFooter)return props.renderFooter();return null;};var renderComposer=function renderComposer(){if(props.renderComposer===null)return null;var composerProps={onInputTextChanged:props.onInputTextChanged,text:props.text,initialText:props.initialText,placeholderColor:props.placeholderColor,placeholderText:props.placeholderText,renderSendButton:props.renderSendButton,renderTextInput:props.renderTextInput,textInputProps:props.textInputProps,media:props.media,onChangeMedia:props.onChangeMedia,user:props.user,onSend:props.onSend,sendButtonMode:props.sendButtonMode,containerStyle:props.composerContainerStyle,inputContainerStyle:props.inputContainerStyle,inputStyle:props.inputStyle,tintColor:props.tintColor,inputRef:inputRef,sendButtonContainerStyle:props.sendButtonContainerStyle,sendOnKeyboardReturn:props.sendOnKeyboardReturn};if(props.renderComposer)return props.renderComposer(composerProps);return React.createElement(Composer,_extends({},composerProps,{__source:{fileName:_jsxFileName,lineNumber:531}}));};var Container=props.ContainerComponent||(props.safeArea?SafeAreaView:View);var KeyboardView=props.avoidKeyboard===false?View:KeyboardAvoidingView;var transition=useMemo(function(){return props.transitionConfig||true&&React.createElement(Transition.Together,{__source:{fileName:_jsxFileName,lineNumber:545}},React.createElement(Transition.Change,{interpolation:"easeInOut",__source:{fileName:_jsxFileName,lineNumber:547}}),React.createElement(Transition.In,{type:"fade",__source:{fileName:_jsxFileName,lineNumber:548}}));},[props.transitionConfig]);var containerStyle=useMemo(function(){return _objectSpread({},styles.container,{},props.containerStyle);},[props.containerStyle]);return React.createElement(Transitioning.View,{ref:transitionRef,transition:transition,style:containerStyle,__source:{fileName:_jsxFileName,lineNumber:561}},React.createElement(Container,{style:containerStyle,__source:{fileName:_jsxFileName,lineNumber:566}},React.createElement(KeyboardView,{style:containerStyle,behavior:"padding",__source:{fileName:_jsxFileName,lineNumber:567}},renderHeader(),renderList(),renderFooter(),renderComposer())));}Chat.append=function(state,messages){return[].concat(_toConsumableArray(messages),_toConsumableArray(state));};export default Chat;var styles=StyleSheet.create({container:{flex:1},contentContainer:{flexGrow:1,marginTop:5}});
//# sourceMappingURL=index.js.map