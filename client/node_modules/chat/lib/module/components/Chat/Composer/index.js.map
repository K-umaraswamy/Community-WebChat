{"version":3,"sources":["index.tsx"],"names":["React","useState","useCallback","useMemo","useEffect","uuid","View","StyleSheet","Keyboard","isIphoneX","getBottomSpace","Input","Send","Composer","props","initialText","textState","setText","text","undefined","onInputTextChanged","onChangeText","mediaState","setMedia","media","onChangeMedia","keyboardOpen","setKeyboardOpen","show","hide","addListener","removeListener","user","messagesReadyToSend","messages","length","forEach","item","message","id","v4","createdAt","Date","push","trim","onSend","send","textInputProps","renderTextInput","renderInput","onSubmitEditing","sendOnKeyboardReturn","inputProps","containerStyle","inputContainerStyle","placeholderColor","placeholderText","style","inputStyle","tintColor","inputRef","renderSendButton","sendButtonMode","hasText","renderSend","sendProps","mode","sendButtonContainerStyle","paddingBottom","styles","container","wrapper","displayName","memo","create","paddingTop","flexDirection","alignItems"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useMemo, useEffect } from 'react'\nimport uuid from 'uuid'\nimport { View, StyleSheet, Keyboard } from 'react-native'\nimport { isIphoneX, getBottomSpace } from 'react-native-iphone-x-helper'\nimport { ComposerProps, InputProps, SendButtonProps } from '../types'\nimport Input from './Input'\nimport Send from './Send'\nimport { MessageMedia, NewMessageModel } from '../../../classes/Message/types'\n\n// const emptyMedia: ComposerProps['media'][] = []\n\nconst Composer = (props: ComposerProps) => {\n\t// First, we set up a state manager for the composer's text.\n\tconst [textState, setText] = useState(props.initialText || '')\n\t// if you pass a text prop, use that state instead\n\tconst [text, onChangeText] = useMemo(\n\t\t() => [\n\t\t\tprops.text !== undefined ? props.text : textState,\n\t\t\tprops.text !== undefined ? props.onInputTextChanged : setText,\n\t\t],\n\t\t[props.text, textState, props.onInputTextChanged]\n\t)\n\n\tconst [mediaState, setMedia] = useState<ComposerProps['media'][]>([])\n\tconst [media, onChangeMedia] = [\n\t\tprops.media || mediaState,\n\t\t(props.media && props.onChangeMedia) || setMedia,\n\t]\n\n\t// track whether or not the keyboard is open to style the bottom based on where or not you're on an iPhone X\n\tconst [keyboardOpen, setKeyboardOpen] = useState(false)\n\tuseEffect(() => {\n\t\tconst show = () => {\n\t\t\tsetKeyboardOpen(true)\n\t\t}\n\t\tconst hide = () => {\n\t\t\tsetKeyboardOpen(false)\n\t\t}\n\t\tKeyboard.addListener('keyboardWillShow', show)\n\t\tKeyboard.addListener('keyboardWillHide', hide)\n\t\treturn () => {\n\t\t\tKeyboard.removeListener('keyboardWillShow', show)\n\t\t\tKeyboard.removeListener('keyboardWillHide', hide)\n\t\t}\n\t}, [])\n\n\tconst { user } = props\n\tconst messagesReadyToSend = useMemo(() => {\n\t\tconst messages: NewMessageModel[] = []\n\t\tif (media && media.length) {\n\t\t\t;(media as MessageMedia[]).forEach((item: MessageMedia) => {\n\t\t\t\tconst message: NewMessageModel = {\n\t\t\t\t\tuser,\n\t\t\t\t\ttext: '',\n\t\t\t\t\tid: uuid.v4(),\n\t\t\t\t\tcreatedAt: new Date(),\n\t\t\t\t\tmedia: item,\n\t\t\t\t}\n\t\t\t\tmessages.push(message)\n\t\t\t})\n\t\t}\n\t\tif (text) {\n\t\t\tconst message: NewMessageModel = {\n\t\t\t\tuser,\n\t\t\t\ttext: text && text.trim(),\n\t\t\t\tid: uuid.v4(),\n\t\t\t\tcreatedAt: new Date(),\n\t\t\t}\n\t\t\tmessages.push(message)\n\t\t}\n\t\treturn messages\n\t}, [user, text, media])\n\n\tconst { onSend } = props\n\tconst send = useCallback(() => {\n\t\tif (messagesReadyToSend.length) {\n\t\t\tif (onChangeText) onChangeText('')\n\t\t\tif (onChangeMedia) onChangeMedia([])\n\t\t\tonSend(messagesReadyToSend)\n\t\t}\n\t}, [onChangeText, onChangeMedia, messagesReadyToSend, onSend])\n\n\tconst { textInputProps, renderTextInput } = props\n\tconst renderInput = useCallback(() => {\n\t\tif (renderTextInput === null) return null\n\n\t\tconst onSubmitEditing: InputProps['onSubmitEditing'] = () => {\n\t\t\tif (props.sendOnKeyboardReturn) send()\n\t\t}\n\n\t\tconst inputProps: InputProps = {\n\t\t\tinputProps: textInputProps,\n\t\t\tonChangeText,\n\t\t\ttext,\n\t\t\tcontainerStyle: props.inputContainerStyle,\n\t\t\tplaceholderColor: props.placeholderColor,\n\t\t\tplaceholderText: props.placeholderText,\n\t\t\tstyle: props.inputStyle,\n\t\t\ttintColor: props.tintColor,\n\t\t\tinputRef: props.inputRef,\n\t\t\tsendOnKeyboardReturn: props.sendOnKeyboardReturn,\n\t\t\tonSubmitEditing,\n\t\t}\n\n\t\tif (renderTextInput) return renderTextInput(inputProps)\n\n\t\treturn <Input {...inputProps} />\n\t}, [\n\t\tonChangeText,\n\t\ttext,\n\t\ttextInputProps,\n\t\trenderTextInput,\n\t\tprops.inputContainerStyle,\n\t\tprops.placeholderColor,\n\t\tprops.placeholderText,\n\t\tprops.inputStyle,\n\t\tprops.tintColor,\n\t\t// TODO leave or take out?\n\t\tprops.inputRef,\n\t\tprops.sendOnKeyboardReturn,\n\t\tsend,\n\t])\n\n\tconst { renderSendButton } = props\n\tconst sendButtonMode =\n\t\tprops.sendButtonMode?.({ hasText: !!(text && text.trim()) }) ?? 'icon'\n\tconst renderSend = useCallback(() => {\n\t\tif (renderSendButton === null) return null\n\n\t\t// const mode: ChatProps['sendButtonMode'] = {\n\t\t// \tempty: 'hidden',\n\t\t// \twithText: 'icon',\n\t\t// \t...(sendButtonMode || {}),\n\t\t// }\n\t\tconst sendProps: SendButtonProps = {\n\t\t\tonSend: send,\n\t\t\ttext,\n\t\t\tmedia: media as MessageMedia[],\n\t\t\tuser,\n\t\t\t// mode: (text && text.trim ? mode.withText : mode.empty) || 'icon',\n\t\t\tmode: sendButtonMode,\n\t\t\tcontainerStyle: props.sendButtonContainerStyle,\n\t\t\ttintColor: props.tintColor,\n\t\t}\n\t\tif (renderSendButton) return renderSendButton(sendProps)\n\n\t\treturn <Send {...sendProps} />\n\t}, [\n\t\tsend,\n\t\ttext,\n\t\tuser,\n\t\tmedia,\n\t\trenderSendButton,\n\t\tsendButtonMode,\n\t\tprops.sendButtonContainerStyle,\n\t\tprops.tintColor,\n\t])\n\n\tconst containerStyle = useMemo(() => {\n\t\tconst paddingBottom = keyboardOpen && isIphoneX() ? 10 : getBottomSpace()\n\t\treturn [styles.container, { paddingBottom }, props.containerStyle]\n\t}, [props.containerStyle, keyboardOpen])\n\n\treturn (\n\t\t<View style={[containerStyle]}>\n\t\t\t<View style={styles.wrapper}>\n\t\t\t\t{renderInput()}\n\t\t\t\t{renderSend()}\n\t\t\t</View>\n\t\t</View>\n\t)\n}\n\nComposer.displayName = 'Juice.Composer'\n\nexport default React.memo(Composer)\n\nconst styles = StyleSheet.create({\n\tcontainer: {\n\t\tpaddingBottom: 10,\n\t\tpaddingTop: 5,\n\t},\n\twrapper: {\n\t\tflexDirection: 'row',\n\t\talignItems: 'flex-end',\n\t},\n})\n"]}