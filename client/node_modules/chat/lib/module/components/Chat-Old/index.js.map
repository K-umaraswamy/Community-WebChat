{"version":3,"sources":["index.tsx"],"names":["React","useMemo","useRef","useEffect","useCallback","SafeAreaView","View","StyleSheet","Animated","Transitioning","Transition","Message","Composer","SystemMessage","Chat","props","ref","inputRef","flatListRef","componentRef","current","focusInput","focus","blurInput","blur","scrollToEnd","scrollToIndex","params","scrollToItem","scrollToOffset","transitionRef","mounted","scrollY","animatedScrollNode","Value","onScroll","event","nativeEvent","contentOffset","y","useNativeDriver","iSentLastMessage","messages","user","id","disableScrollToBottomOnSend","offset","scrollToBottomOnAllNewMessages","onViewableItemsChangedRef","onViewableItemsChanged","onViewMessagesRef","onViewMessages","messagesRef","info","visibleMessages","viewableItems","filter","i","isViewable","map","item","latestMessageId","disableTransitions","disableTransitionOnMount","animateNextTransition","namesOfUsersTyping","renderItem","renderMessage","message","index","system","systemProps","text","createdAt","textStyle","systemMessageTextStyle","containerStyle","systemMessageContainerStyle","dateToStringFunc","systemMessageDateToStringFunc","dateStyle","systemMessageDateStyle","renderSystemMessage","isMe","messageCreatesNewBunch","showName","showAvatar","showAvatarForEveryMessage","hideMyAvatar","bubbleStyle","messageContainerStyle","bubbleTextStyle","messageWrapperStyle","messageProps","delivered","renderFooter","renderMessageFooter","imageProps","media","name","read","renderMedia","renderMessageMedia","onLongPress","onLongPressMessage","onPress","onPressMessage","pressType","messagePressType","doubleTapDelay","messageDoubleTapDelay","disableSwipeActions","swipeActions","longPressDelay","messageLongPressDelay","avatar","avatarImageProps","avatarSize","renderAvatar","initialsBackgroundColor","initialsTextColor","renderInitials","keyExtractor","renderList","flatListProps","extraData","ListFooterComponent","keyboardShouldPersistTaps","keyboardDismissMode","styles","contentContainer","contentContainerStyle","renderHeader","renderComposer","composerProps","onInputTextChanged","initialText","placeholderColor","placeholderText","renderSendButton","renderTextInput","textInputProps","onChangeMedia","onSend","sendButtonMode","composerContainerStyle","inputContainerStyle","inputStyle","tintColor","Container","ContainerComponent","safeArea","transition","transitionConfig","container","create","flex","flexGrow"],"mappings":"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","sourcesContent":["import React, {\n\tuseMemo,\n\tuseRef,\n\tuseEffect,\n\tuseCallback,\n\tMutableRefObject\n} from 'react'\nimport {\n\tFlatList,\n\tListRenderItemInfo,\n\tSafeAreaView,\n\tView,\n\tStyleSheet,\n\tAnimated,\n\tViewToken,\n\tTextInput\n} from 'react-native'\nimport {\n\tTransitioning,\n\tTransition,\n\tTransitioningView\n} from 'react-native-reanimated'\nimport Message from './Message'\nimport {\n\tChatProps,\n\tMessageProps,\n\tComposerProps,\n\tSystemMessageProps,\n\tChatRef\n} from './types'\nimport { NewMessageModel } from '../../classes/Message/types'\nimport Composer from './Composer'\nimport SystemMessage from './SystemMessage'\n\nfunction Chat<MessageModel extends NewMessageModel = NewMessageModel>(\n\tprops: ChatProps<MessageModel>,\n\tref: MutableRefObject<ChatRef<MessageModel>>\n) {\n\t// \"constructor\" variables\n\n\tconst inputRef = useRef<TextInput>()\n\tconst flatListRef = useRef<FlatList<MessageModel>>()\n\tconst componentRef = useRef<ChatRef<MessageModel>>()\n\n\tif (!componentRef.current) {\n\t\tcomponentRef.current = {\n\t\t\tfocusInput: () => inputRef.current && inputRef.current.focus(),\n\t\t\tblurInput: () => inputRef.current && inputRef.current.blur(),\n\t\t\tscrollToEnd: () =>\n\t\t\t\tflatListRef.current && flatListRef.current.scrollToEnd(),\n\t\t\tscrollToIndex: params =>\n\t\t\t\tflatListRef.current && flatListRef.current.scrollToIndex(params),\n\t\t\tscrollToItem: params =>\n\t\t\t\tflatListRef.current && flatListRef.current.scrollToItem(params),\n\t\t\tscrollToOffset: params =>\n\t\t\t\tflatListRef.current && flatListRef.current.scrollToOffset(params)\n\t\t}\n\t\tif (ref) ref.current = componentRef.current\n\t}\n\n\t// used to shuffle/transition the inbox when it changes\n\tconst transitionRef = useRef<TransitioningView>(null)\n\tconst mounted = useRef(false)\n\n\t// track animated position of scroll\n\tconst scrollY: Animated.Value = useMemo(\n\t\t() => props.animatedScrollNode || new Animated.Value(0),\n\t\t[props.animatedScrollNode]\n\t)\n\n\t// upate position of scroll variable\n\tconst onScroll = Animated.event(\n\t\t[{ nativeEvent: { contentOffset: { y: scrollY } } }],\n\t\t{ useNativeDriver: true }\n\t)\n\n\t// effect to handle new messages coming in / scrolling to bottom\n\t// TODO we may have to use getNode() for the animated flatlist, right?\n\tuseEffect(() => {\n\t\tif (flatListRef.current) {\n\t\t\tconst iSentLastMessage =\n\t\t\t\tprops.messages[0] &&\n\t\t\t\tprops.messages[0].user &&\n\t\t\t\tprops.messages[0].user.id === props.user.id\n\t\t\tif (iSentLastMessage && !props.disableScrollToBottomOnSend)\n\t\t\t\tflatListRef.current.scrollToOffset({ offset: 0 })\n\t\t\telse if (props.scrollToBottomOnAllNewMessages)\n\t\t\t\tflatListRef.current.scrollToOffset({ offset: 0 })\n\t\t}\n\t}, [\n\t\tprops.disableScrollToBottomOnSend,\n\t\tprops.scrollToBottomOnAllNewMessages,\n\t\tprops.messages,\n\t\tprops.user.id\n\t])\n\n\t// 💩 a super way of handling viewable items not on the fly. (easy way to track viewed messages)\n\t// TODO abstract this to a different custom hook.\n\tconst onViewableItemsChangedRef = useRef(props.onViewableItemsChanged)\n\tconst onViewMessagesRef = useRef(props.onViewMessages)\n\tconst messagesRef = useRef(props.messages)\n\t// ...onto the effect 😅\n\tuseEffect(() => {\n\t\t// make updated methods available to onviewable items changed\n\t\tonViewableItemsChangedRef.current = props.onViewableItemsChanged\n\t\tonViewMessagesRef.current = props.onViewMessages\n\t\tmessagesRef.current = props.messages\n\t}, [props.onViewableItemsChanged, props.onViewMessages, props.messages])\n\n\tconst onViewableItemsChanged: FlatList<\n\t\tMessageModel\n\t>['props']['onViewableItemsChanged'] = useCallback(\n\t\t(info: { viewableItems: ViewToken[]; changed: ViewToken[] }) => {\n\t\t\tif (onViewableItemsChangedRef.current)\n\t\t\t\tonViewableItemsChangedRef.current(info)\n\n\t\t\tif (onViewMessagesRef.current) {\n\t\t\t\tconst visibleMessages = info.viewableItems\n\t\t\t\t\t.filter(i => i.isViewable)\n\t\t\t\t\t.map(i => i.item)\n\t\t\t\tconst latestMessageId =\n\t\t\t\t\tmessagesRef.current &&\n\t\t\t\t\tmessagesRef.current[0] &&\n\t\t\t\t\tmessagesRef.current[0].id\n\t\t\t\tonViewMessagesRef.current({\n\t\t\t\t\tvisibleMessages,\n\t\t\t\t\tlatestMessageId\n\t\t\t\t})\n\t\t\t}\n\t\t},\n\t\t[]\n\t)\n\t// END OF THAT 💩\n\n\t// effect to handle animating the screen if the messages changed or people typing just changed\n\tuseEffect(() => {\n\t\tif (\n\t\t\t!props.disableTransitions &&\n\t\t\t// if we've already mounted, or we want to transition even if we haven't...\n\t\t\t(mounted.current || !props.disableTransitionOnMount) &&\n\t\t\t// and assuming the transition component is initialized...\n\t\t\ttransitionRef.current\n\t\t)\n\t\t\t// animate\n\t\t\ttransitionRef.current.animateNextTransition()\n\t\telse mounted.current = true\n\t}, [\n\t\tprops.disableTransitionOnMount,\n\t\tprops.namesOfUsersTyping,\n\t\tprops.messages,\n\t\tprops.disableTransitions\n\t])\n\n\tconst renderItem = (info: ListRenderItemInfo<MessageModel>) => {\n\t\tif (props.renderItem) return props.renderItem(info)\n\t\tif (props.renderMessage === null) return null\n\n\t\tconst { item: message, index } = info\n\n\t\tif (message.system) {\n\t\t\tconst systemProps: SystemMessageProps = {\n\t\t\t\ttext: message.text,\n\t\t\t\tcreatedAt: message.createdAt,\n\t\t\t\ttextStyle: props.systemMessageTextStyle,\n\t\t\t\tcontainerStyle: props.systemMessageContainerStyle,\n\t\t\t\tdateToStringFunc: props.systemMessageDateToStringFunc,\n\t\t\t\tdateStyle: props.systemMessageDateStyle\n\t\t\t}\n\n\t\t\tif (props.renderSystemMessage === null) return null\n\t\t\tif (props.renderSystemMessage)\n\t\t\t\treturn props.renderSystemMessage(systemProps)\n\n\t\t\treturn <SystemMessage {...systemProps} />\n\t\t}\n\n\t\tconst isMe = message.user.id === props.user.id\n\n\t\t// indicates that the previous message was sent by someone else, so this starts a new bunch\n\t\tconst messageCreatesNewBunch = !(\n\t\t\tprops.messages[index + 1] &&\n\t\t\tprops.messages[index + 1].user &&\n\t\t\tprops.messages[index + 1].user.id === (props.user && props.user.id)\n\t\t)\n\n\t\t// show name if the previous message was sent by someone else\n\t\tconst showName = !isMe && messageCreatesNewBunch\n\n\t\t// by default, only show avatar for a the bottom of a bunch\n\t\tlet showAvatar = props.showAvatarForEveryMessage || messageCreatesNewBunch\n\t\t// and we hide the avatar if we say to\n\t\tif (isMe && props.hideMyAvatar) showAvatar = false\n\n\t\tconst bubbleStyle =\n\t\t\tprops.bubbleStyle && props.bubbleStyle[isMe ? 'me' : 'others']\n\t\tconst messageContainerStyle =\n\t\t\tprops.messageContainerStyle &&\n\t\t\tprops.messageContainerStyle[isMe ? 'me' : 'others']\n\t\tconst bubbleTextStyle =\n\t\t\tprops.bubbleTextStyle && props.bubbleTextStyle[isMe ? 'me' : 'others']\n\t\tconst messageWrapperStyle =\n\t\t\tprops.messageWrapperStyle &&\n\t\t\tprops.messageWrapperStyle[isMe ? 'me' : 'others']\n\n\t\tconst messageProps: MessageProps = {\n\t\t\tmessageContainerStyle,\n\t\t\tbubbleStyle,\n\t\t\tbubbleTextStyle,\n\t\t\tmessageWrapperStyle,\n\t\t\tdelivered: true,\n\t\t\tisMe: message.user.id === props.user.id,\n\t\t\trenderFooter: props.renderMessageFooter,\n\t\t\timageProps: props.imageProps,\n\t\t\tmedia: message.media,\n\t\t\tname: message.user.name,\n\t\t\tsystem: message.system,\n\t\t\ttext: message.text,\n\t\t\tread: true,\n\t\t\trenderMedia: props.renderMessageMedia,\n\t\t\tonLongPress: props.onLongPressMessage,\n\t\t\tonPress: props.onPressMessage,\n\t\t\tpressType: props.messagePressType || 'double',\n\t\t\tdoubleTapDelay: props.messageDoubleTapDelay,\n\t\t\tdisableSwipeActions: props.disableSwipeActions,\n\t\t\tswipeActions: props.swipeActions,\n\t\t\tlongPressDelay: props.messageLongPressDelay,\n\t\t\tid: message.id,\n\t\t\tshowName,\n\t\t\tavatar: message.user.avatar,\n\t\t\tavatarImageProps: props.avatarImageProps,\n\t\t\tavatarSize: props.avatarSize,\n\t\t\trenderAvatar: props.renderAvatar,\n\t\t\tshowAvatar,\n\t\t\tinitialsBackgroundColor: props.initialsBackgroundColor,\n\t\t\tinitialsTextColor: props.initialsTextColor,\n\t\t\trenderInitials: props.renderInitials\n\t\t}\n\n\t\tif (props.renderMessage) return props.renderMessage(messageProps)\n\t\treturn <Message {...messageProps} />\n\t}\n\n\tconst keyExtractor = useMemo(\n\t\t() => props.keyExtractor || (({ id }: MessageModel) => id),\n\t\t[props.keyExtractor]\n\t)\n\n\tconst renderList = () => {\n\t\treturn (\n\t\t\t<Animated.FlatList\n\t\t\t\t{...props.flatListProps}\n\t\t\t\tref={flatListRef as MutableRefObject<FlatList<MessageModel>>}\n\t\t\t\tdata={props.messages}\n\t\t\t\tkeyExtractor={keyExtractor}\n\t\t\t\trenderItem={renderItem}\n\t\t\t\textraData={props.extraData}\n\t\t\t\tListHeaderComponent={props.ListFooterComponent}\n\t\t\t\tinverted\n\t\t\t\tonScroll={onScroll}\n\t\t\t\tonViewableItemsChanged={onViewableItemsChanged}\n\t\t\t\tkeyboardShouldPeristTaps={props.keyboardShouldPersistTaps || 'handled'}\n\t\t\t\tkeyboardDismissMode={props.keyboardDismissMode || 'interactive'}\n\t\t\t\tcontentContainerStyle={{\n\t\t\t\t\t...styles.contentContainer,\n\t\t\t\t\t...(props.contentContainerStyle || {})\n\t\t\t\t}}\n\t\t\t/>\n\t\t)\n\t}\n\tconst renderHeader = () => {\n\t\tif (props.renderHeader) return props.renderHeader()\n\t\treturn null\n\t}\n\tconst renderFooter = () => {\n\t\tif (props.renderFooter) return props.renderFooter()\n\t\treturn null\n\t}\n\tconst renderComposer = () => {\n\t\tif (props.renderComposer === null) return null\n\n\t\tconst composerProps: ComposerProps = {\n\t\t\tonInputTextChanged: props.onInputTextChanged,\n\t\t\ttext: props.text,\n\t\t\tinitialText: props.initialText,\n\t\t\tplaceholderColor: props.placeholderColor,\n\t\t\tplaceholderText: props.placeholderText,\n\t\t\trenderSendButton: props.renderSendButton,\n\t\t\trenderTextInput: props.renderTextInput,\n\t\t\ttextInputProps: props.textInputProps,\n\t\t\tmedia: props.media,\n\t\t\tonChangeMedia: props.onChangeMedia,\n\t\t\tuser: props.user,\n\t\t\tonSend: props.onSend,\n\t\t\tsendButtonMode: props.sendButtonMode,\n\t\t\tcontainerStyle: props.composerContainerStyle,\n\t\t\tinputContainerStyle: props.inputContainerStyle,\n\t\t\tinputStyle: props.inputStyle,\n\t\t\ttintColor: props.tintColor,\n\t\t\tinputRef: inputRef as MutableRefObject<TextInput>\n\t\t}\n\t\tif (props.renderComposer) return props.renderComposer(composerProps)\n\n\t\treturn <Composer {...composerProps} />\n\t}\n\n\t// now, onto the actual render code\n\tconst Container =\n\t\tprops.ContainerComponent || (props.safeArea ? SafeAreaView : View)\n\n\t// reanimated transition\n\tconst transition = useMemo(\n\t\t() =>\n\t\t\tprops.transitionConfig || (\n\t\t\t\t<Transition.Sequence>\n\t\t\t\t\t<Transition.Together>\n\t\t\t\t\t\t<Transition.Out type=\"fade\" />\n\t\t\t\t\t\t<Transition.Change interpolation=\"easeOut\" />\n\t\t\t\t\t</Transition.Together>\n\t\t\t\t\t<Transition.In type=\"fade\" />\n\t\t\t\t</Transition.Sequence>\n\t\t\t),\n\t\t[props.transitionConfig]\n\t)\n\tconst containerStyle = useMemo(\n\t\t() => ({\n\t\t\t...styles.container,\n\t\t\t...props.containerStyle\n\t\t}),\n\t\t[props.containerStyle]\n\t)\n\treturn (\n\t\t<Transitioning.View\n\t\t\tref={transitionRef}\n\t\t\ttransition={transition}\n\t\t\tstyle={containerStyle}\n\t\t>\n\t\t\t<Container style={containerStyle}>\n\t\t\t\t{renderHeader()}\n\t\t\t\t{renderList()}\n\t\t\t\t{renderFooter()}\n\t\t\t\t{renderComposer()}\n\t\t\t</Container>\n\t\t</Transitioning.View>\n\t)\n}\n\nexport default Chat\n\nconst styles = StyleSheet.create({\n\tcontainer: {\n\t\tflex: 1\n\t},\n\tcontentContainer: {\n\t\tflexGrow: 1\n\t}\n})\n"]}