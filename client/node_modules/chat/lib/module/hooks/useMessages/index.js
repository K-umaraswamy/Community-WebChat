import _defineProperty from"@babel/runtime/helpers/defineProperty";import _slicedToArray from"@babel/runtime/helpers/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/objectWithoutProperties";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{useMemo,useCallback,useState,useEffect,useRef}from'react';import{useFuego}from'@nandorojo/fuego';import Room from'../../classes/Room';import Message from'../../classes/Message';var LIMIT=30;var orderBy=['createdAt','desc'];export default(function(_ref){var id=_ref.id,config=_objectWithoutProperties(_ref,["id"]);var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _ref2=new Room({id:id}),path=_ref2.messagesPath;var _useState=useState(LIMIT),_useState2=_slicedToArray(_useState,2),limit=_useState2[0],setLimit=_useState2[1];var currentLimit=useRef(limit);var latestFetchMoreId=useRef(null);var query=useMemo(function(){return _objectSpread({listen:true,orderBy:orderBy},config,{path:path,limit:limit});},[path,config,limit]);useEffect(function(){currentLimit.current=limit;},[limit]);var _useFuego=useFuego(query,options),data=_useFuego.data,loading=_useFuego.loading,error=_useFuego.error,ref=_useFuego.ref;var send=useCallback(function(message){return new Message(message).formatForSend().send(id);},[id]);var edit=useCallback(function(message){return new Message(message).edit(id);},[id]);var formattedMessages=useMemo(function(){function isArrayOfMessageDocuments(m){return!!m;}if(data&&isArrayOfMessageDocuments(data)){var formatted=new Message(data).formatForRender();return formatted;}return[];},[data]);var fetchMore=function fetchMore(){var lastMessageId=formattedMessages[formattedMessages.length-1]&&formattedMessages[formattedMessages.length-1].id;if(lastMessageId&&lastMessageId!==latestFetchMoreId.current){latestFetchMoreId.current=lastMessageId;setLimit(function(l){return l+LIMIT;});}};var empty=useMemo(function(){return!(formattedMessages&&formattedMessages.length);},[formattedMessages]);var fetchingMore=loading&&formattedMessages.length;return{data:formattedMessages,loading:loading,error:error,ref:ref,path:path,empty:empty,send:send,edit:edit,fetchMore:fetchMore,fetchingMore:fetchingMore};});
//# sourceMappingURL=index.js.map